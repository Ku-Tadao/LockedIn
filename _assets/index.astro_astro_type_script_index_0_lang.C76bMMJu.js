const F=document.getElementById("app-data"),W=F?JSON.parse(F.dataset.payload||"{}"):{},w="https://api.deadlock-api.com",k={metaLoaded:!1,lbLoaded:!1,lbRegion:"Europe"},O=t=>(t||"").toString().toLowerCase().trim(),u=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function C(t){document.documentElement.setAttribute("data-theme",t),localStorage.setItem("li-theme",t);const e=document.getElementById("themeToggle");e&&(e.textContent=t==="dark"?"Light Mode":"Dark Mode")}function J(){const t=localStorage.getItem("li-theme");if(t){C(t);return}C(window.matchMedia?.("(prefers-color-scheme:dark)").matches?"dark":"light")}function G(t){document.querySelectorAll(".nav-link").forEach(e=>e.classList.toggle("active",e.dataset.section===t))}function A(t){document.querySelectorAll("section.content").forEach(o=>{o.style.display="none"});const e=document.getElementById(t);e&&(e.style.display="",G(t),history.replaceState(null,"","#"+t)),t==="stats"&&!k.metaLoaded&&(k.metaLoaded=!0,x()),t==="leaderboard"&&!k.lbLoaded&&(k.lbLoaded=!0,N(k.lbRegion))}function K(t){const e=O(t);document.querySelectorAll(".hero-card").forEach(o=>{const l=o.dataset.heroName||"",n=o.dataset.heroType||"";o.style.display=!e||l.includes(e)||n.includes(e)?"":"none"})}function H(t){return W.heroes?.find(e=>String(e.id)===String(t))}function R(t){const e=H(t);if(!e)return;const o=document.getElementById("heroModal");document.getElementById("modalHeroName").textContent="";const l=document.getElementById("modalHeroDetails");l.innerHTML="",o.classList.remove("hidden"),o.setAttribute("aria-hidden","false");const n="var(--"+(e.hero_type||"brand")+")";let s="";const d=e.images?.icon_hero_card_webp||e.images?.icon_hero_card||"";if(s+='<div class="hd-header">',s+='<img class="hd-portrait" src="'+d+'" alt="'+u(e.name)+'" />',s+='<div class="hd-info">',s+='<h2 class="hd-name">'+u(e.name)+"</h2>",s+='<span class="hd-type-pill '+(e.hero_type||"")+'">'+u(e.hero_type||"Unknown")+"</span>",e.description&&(s+='<p class="hd-desc">'+u(e.description)+"</p>"),e.tags&&e.tags.length&&(s+='<div class="hd-tags">',e.tags.forEach(a=>{s+='<span class="hd-tag">'+u(a)+"</span>"}),s+="</div>"),s+="</div></div>",e.complexity){s+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Complexity</h4></div>',s+='<div style="display:flex;gap:4px;margin-bottom:1rem">';for(let a=1;a<=4;a++){const c=a<=e.complexity;s+='<span style="width:24px;height:8px;border-radius:4px;background:'+(c?n:"var(--surface-strong)")+'"></span>'}s+="</div></div>"}if(e.starting_stats){const a=e.starting_stats;s+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Starting Stats</h4></div>',s+='<div class="hd-stats-grid">',[["Max Health",a.max_health],["Health Regen",a.health_regen],["Bullet Armor",a.bullet_armor&&a.bullet_armor!=="0"?a.bullet_armor+"%":null],["Spirit Armor",a.spirit_armor&&a.spirit_armor!=="0"?a.spirit_armor+"%":null],["Move Speed",a.move_speed],["Sprint Speed",a.sprint_speed],["Stamina",a.stamina],["Bullet Resist",a.bullet_resist&&a.bullet_resist!=="0%"?a.bullet_resist:null],["Crit Multiplier",a.crit_damage_received_scale]].filter(([,r])=>r!=null&&r!==""&&r!==0&&r!=="0").forEach(([r,v])=>{s+='<div class="hd-stat-card"><div class="hd-stat-value" style="color:'+n+'">'+u(String(v))+"</div>",s+='<div class="hd-stat-label">'+u(r)+"</div></div>"}),s+="</div></div>"}if(e.weapon_stats_display){const a=e.weapon_stats_display;s+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Weapon Stats</h4></div>',s+='<div class="hd-stats-grid">',[["Bullet Damage",a.bullet_damage],["Bullets/sec",a.bullets_per_sec],["DPS",a.dps],["Clip Size",a.clip_size],["Ammo (Low)",a.ammo_low],["Ammo (Mid)",a.ammo_mid],["Ammo (High",a.ammo_high],["Reload Time",a.reload_time?a.reload_time+"s":null],["Light Melee",a.light_melee_damage],["Heavy Melee",a.heavy_melee_damage]].filter(([,r])=>r!=null&&r!==""&&r!==0).forEach(([r,v])=>{s+='<div class="hd-stat-card"><div class="hd-stat-value" style="color:'+n+'">'+u(String(v))+"</div>",s+='<div class="hd-stat-label">'+u(r)+"</div></div>"}),s+="</div></div>"}if(e.items&&e.items.length){const a=e.items.filter(c=>c&&c.name);a.length&&(s+='<div class="hd-abilities-section"><h4>Abilities</h4>',a.forEach(c=>{const r=c.image?'<img src="'+c.image+'" alt="" class="ability-image">':"";s+='<div class="ability-box"><div class="ability-header">'+u(c.name)+"</div>",s+='<div class="ability-details">'+r+"<div>"+u(c.description||"No description available.")+"</div></div></div>"}),s+="</div>")}l.innerHTML=s}function L(){const t=document.getElementById("heroModal");t.classList.add("hidden"),t.setAttribute("aria-hidden","true")}function S(t){const e=document.getElementById("playerModal");if(!e)return;e.classList.remove("hidden");const o=document.getElementById("playerInput");o&&t?(o.value=t,I()):o&&!t&&o.focus()}function B(){const t=document.getElementById("playerModal");if(!t)return;t.classList.add("hidden");const e=document.getElementById("playerSearchResults"),o=document.getElementById("playerProfile");e&&(e.innerHTML=""),o&&(o.innerHTML="",o.classList.add("hidden"))}function P(){const t=document.getElementById("ovSearch");if(!t)return;const e=t.value.trim();e&&S(e)}async function I(){const t=document.getElementById("playerInput"),e=document.getElementById("playerSearchResults"),o=document.getElementById("playerProfile");if(!t||!e)return;const l=t.value.trim();if(!l){e.innerHTML='<div class="status">Enter a Steam username.</div>';return}e.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Searching...</div>',e.classList.remove("hidden"),o&&o.classList.add("hidden");try{const n=await fetch(w+"/v1/players/steam-search?username="+encodeURIComponent(l));if(!n.ok)throw new Error("HTTP "+n.status);const s=await n.json();if(!s||!s.length){e.innerHTML='<div class="status">No players found for "'+u(l)+'".</div>';return}e.innerHTML='<div class="search-results-header"><h3>'+s.length+" player"+(s.length!==1?"s":"")+' found</h3></div><div class="player-results-grid">'+s.slice(0,20).map(d=>'<div class="player-result-card" data-pid="'+u(d.account_id||d.steam_id)+'"><img class="player-result-avatar" src="'+(d.avatar_url||d.avatar||"")+`" alt="" loading="lazy" onerror="this.style.display='none'" /><div class="player-result-info"><h4>`+u(d.persona_name||d.name||"Unknown")+"</h4><p>"+u(d.account_id||d.steam_id||"")+"</p></div></div>").join("")+"</div>",e.querySelectorAll(".player-result-card").forEach(d=>d.addEventListener("click",()=>j(d.dataset.pid)))}catch{e.innerHTML='<div class="status">Search error. Please try again.</div>'}}async function j(t){const e=document.getElementById("playerSearchResults"),o=document.getElementById("playerProfile");if(o){o.classList.remove("hidden"),o.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Loading profile...</div>',e&&e.classList.add("hidden");try{const[l,n]=await Promise.allSettled([fetch(w+"/v1/players/"+encodeURIComponent(t)+"/match-history?limit=20"),fetch(w+"/v1/players/"+encodeURIComponent(t)+"/mmr-history")]),s=l.status==="fulfilled"&&l.value.ok?await l.value.json():null,d=n.status==="fulfilled"&&n.value.ok?await n.value.json():null;let a='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back to results</button>';if(a+='<div class="player-profile-header">',a+='<div class="player-profile-info"><h3>Player '+u(t)+"</h3>",d&&d.length){const c=d[d.length-1];c.badge_level!=null&&(a+="<p>Current Badge Level: <strong>"+c.badge_level+"</strong></p>")}if(a+="</div></div>",s&&s.length){let c=0,r=0;s.forEach(h=>{h.match_result==="Win"||h.player_team_won?c++:r++});const v=s.length>0?c/s.length*100:0;a+='<h4 class="sub-title">Recent Matches ('+s.length+")</h4>",a+='<div class="donut-container">'+Q(v)+'<div class="donut-stats-side"><div class="ds-row"><span class="ds-label">Matches</span><span class="ds-value">'+s.length+'</span></div><div class="ds-row"><span class="ds-label">Wins</span><span class="ds-value" style="color:var(--accent)">'+c+'</span></div><div class="ds-row"><span class="ds-label">Losses</span><span class="ds-value" style="color:var(--brawler)">'+r+"</span></div></div></div>";const m={};s.forEach(h=>{const i=h.hero_id;i&&(m[i]||(m[i]={count:0,wins:0}),m[i].count++,(h.match_result==="Win"||h.player_team_won)&&m[i].wins++)});const g=Object.entries(m).sort((h,i)=>i[1].count-h[1].count).slice(0,8);if(g.length){const h=g[0][1].count;a+='<h4 class="sub-title">Most Played Heroes</h4><div class="hero-time-list">',g.forEach(([i,p])=>{const y=H(i),_=y?.images?.icon_image_small_webp||y?.images?.icon_image_small||"",b=y?.name||"Hero #"+i,T=h>0?p.count/h*100:0,D=p.count>0?p.wins/p.count*100:0,U=D>=50?"var(--accent)":"var(--brawler)";a+='<div class="hero-time-row">'+(_?'<img src="'+_+'" alt="" loading="lazy"/>':"<div></div>")+'<div><span class="htb-name">'+u(b)+'</span><div class="htb-bar"><div class="htb-bar-fill" style="width:'+T.toFixed(1)+'%"></div></div></div><span class="hero-time-stats"><span style="color:'+U+'">'+D.toFixed(0)+"%</span> · "+p.count+" games</span></div>"}),a+="</div>"}}else a+='<div class="status">No match history available or profile is private.</div>';o.innerHTML=a,document.getElementById("backBtn")?.addEventListener("click",q)}catch{o.innerHTML='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back</button><div class="status">Error loading profile.</div>',document.getElementById("backBtn")?.addEventListener("click",q)}}}function q(){const t=document.getElementById("playerSearchResults"),e=document.getElementById("playerProfile");t&&t.classList.remove("hidden"),e&&e.classList.add("hidden")}function Q(t){const o=t/100*251.2,l=t>=50?"var(--accent)":"var(--brawler)";return'<div class="donut-chart"><svg viewBox="0 0 90 90"><circle class="donut-ring" cx="45" cy="45" r="40"/><circle class="donut-segment" cx="45" cy="45" r="40" stroke="'+l+'" stroke-dasharray="'+o.toFixed(1)+" "+251.2+'"/></svg><div class="donut-label"><span class="donut-value" style="color:'+l+'">'+t.toFixed(1)+'%</span><span class="donut-desc">Win Rate</span></div></div>'}let f="winrate",E="desc",M=null;async function x(){const t=document.getElementById("metaStatus"),e=document.getElementById("metaBody");if(!e)return;t&&(t.textContent="Loading hero stats..."),e.innerHTML='<tr><td colspan="8"><div class="meta-empty" style="animation:pulse 1.5s infinite"><p>Loading...</p></div></td></tr>';const o=document.getElementById("metaMinBadge")?.value||"0",l=document.getElementById("metaHeroType")?.value||"";let n=w+"/v1/analytics/hero-stats?min_badge_level="+o;try{const s=await fetch(n);if(!s.ok)throw new Error("HTTP "+s.status);const d=await s.json();if(!d||!d.length){e.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>No stats available.</p></div></td></tr>',t&&(t.textContent="No data found");return}const a=d.reduce((r,v)=>r+(v.matches||0),0);let c=d.map(r=>{const v=H(r.hero_id),m=r.matches||1;return{...r,hero:v,hero_type:v?.hero_type||"",win_rate:r.wins/m,pick_rate:a>0?m/a:0,avg_kills:(r.total_kills||0)/m,avg_deaths:(r.total_deaths||0)/m,avg_assists:(r.total_assists||0)/m}});l&&(c=c.filter(r=>r.hero_type===l)),M=c,f="winrate",E="desc",z(),t&&(t.textContent="Showing "+c.length+" heroes")}catch{e.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>Error loading stats. Try again.</p></div></td></tr>',t&&(t.textContent="Error loading stats")}}function z(){if(!M)return;const t=M.slice().sort((e,o)=>{let l,n;return f==="hero"?(l=(e.hero?.name||"").toLowerCase(),n=(o.hero?.name||"").toLowerCase(),E==="asc"?l.localeCompare(n):n.localeCompare(l)):f==="type"?(l=e.hero_type,n=o.hero_type,E==="asc"?l.localeCompare(n):n.localeCompare(l)):(f==="winrate"?(l=e.win_rate??e.winrate??0,n=o.win_rate??o.winrate??0):f==="pickrate"?(l=e.pick_rate??e.pickrate??0,n=o.pick_rate??o.pickrate??0):f==="matches"?(l=e.total_matches??e.matches??0,n=o.total_matches??o.matches??0):f==="kills"?(l=e.avg_kills??e.kills??0,n=o.avg_kills??o.kills??0):f==="deaths"?(l=e.avg_deaths??e.deaths??0,n=o.avg_deaths??o.deaths??0):f==="assists"?(l=e.avg_assists??e.assists??0,n=o.avg_assists??o.assists??0):(l=0,n=0),E==="asc"?l-n:n-l)});V(t)}function V(t){const e=document.getElementById("metaBody");if(!e)return;document.querySelectorAll("#metaTable thead th.sortable").forEach(n=>{const s=n.dataset.sort;n.classList.toggle("sort-active",s===f);const d=n.querySelector(".sort-arrow");if(d&&d.remove(),s===f){const a=document.createElement("span");a.className="sort-arrow",a.textContent=E==="asc"?" ▲":" ▼",n.appendChild(a)}});const o=Math.max(...t.map(n=>n.pick_rate??n.pickrate??0));let l="";t.forEach(n=>{const s=n.hero,d=s?.images?.icon_image_small_webp||s?.images?.icon_image_small||"",a=s?.name||"Hero #"+n.hero_id,c=n.hero_type||"unknown",r="var(--"+c+", var(--muted))",v=n.win_rate??n.winrate??0,m=n.pick_rate??n.pickrate??0,g=n.total_matches??n.matches??0,h=n.avg_kills??n.kills??0,i=n.avg_deaths??n.deaths??0,p=n.avg_assists??n.assists??0,y=(v*100).toFixed(1),_=(m*100).toFixed(2),b=o>0?m/o*100:0,T=v>=.5?"var(--accent)":"var(--brawler)";l+='<tr><td><div class="meta-hero-cell">'+(d?'<img class="meta-hero-portrait" src="'+d+'" alt="" loading="lazy"/>':"")+"<span>"+u(a)+'</span></div></td><td><span style="color:'+r+';font-weight:600;text-transform:capitalize;font-family:Chakra Petch,system-ui,sans-serif;font-size:.78rem">'+u(c)+'</span></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill winrate" style="width:'+y+"%;background:"+T+'"></div></div><span class="stat-value-label">'+y+'%</span></div></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill pickrate" style="width:'+b.toFixed(1)+'%"></div></div><span class="stat-value-label">'+_+"%</span></div></td><td>"+g.toLocaleString()+"</td><td>"+(typeof h=="number"?h.toFixed(1):h)+"</td><td>"+(typeof i=="number"?i.toFixed(1):i)+"</td><td>"+(typeof p=="number"?p.toFixed(1):p)+"</td></tr>"}),e.innerHTML=l||'<tr><td colspan="8"><div class="meta-empty"><p>No data.</p></div></td></tr>'}async function N(t){k.lbRegion=t;const e=document.getElementById("lbStatus"),o=document.getElementById("lbBody");if(o){e&&(e.textContent="Loading "+t+" leaderboard..."),o.innerHTML='<tr class="lb-placeholder"><td colspan="5"><div class="lb-empty"><div class="loading-dots"><span></span><span></span><span></span></div><p>Loading...</p></div></td></tr>',document.querySelectorAll(".region-btn").forEach(l=>l.classList.toggle("active",l.dataset.region===t));try{const l=await fetch(w+"/v1/leaderboard/"+encodeURIComponent(t));if(!l.ok)throw new Error("HTTP "+l.status);const n=await l.json(),s=Array.isArray(n)?n:n.entries||[];if(!s||!s.length){o.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>No leaderboard data available.</p></div></td></tr>',e&&(e.textContent="No data for "+t);return}let d="";s.slice(0,100).forEach(a=>{const c=a.rank??"-",r=typeof c=="number"?c:0,v=r===1?"top-1":r===2?"top-2":r===3?"top-3":"",m=a.account_name||"Unknown",g=a.badge_level??"-",h=a.ranked_rank!=null?a.ranked_rank:"-",i=a.ranked_subrank!=null?a.ranked_subrank:"",p=h!=="-"?h+(i?"."+i:""):"-";let y="-";a.top_hero_ids&&a.top_hero_ids.length&&(y=a.top_hero_ids.slice(0,3).map(_=>{const b=H(_);return b?u(b.name):"Hero #"+_}).join(", ")),d+='<tr><td class="lb-rank-cell '+v+'">'+c+'</td><td class="lb-player-cell"><span>'+u(m)+'</span></td><td class="lb-badge-cell">'+g+"</td><td>"+p+"</td><td>"+y+"</td></tr>"}),o.innerHTML=d,e&&(e.textContent="Showing top "+Math.min(s.length,100)+" players in "+t)}catch{o.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>Error loading leaderboard.</p></div></td></tr>',e&&(e.textContent="Error loading leaderboard")}}}function X(){document.querySelectorAll(".nav-link").forEach(i=>i.addEventListener("click",()=>A(i.dataset.section)));const t=document.getElementById("heroSearch");t&&t.addEventListener("input",i=>K(i.target.value)),document.querySelectorAll(".hero-card").forEach(i=>i.addEventListener("click",()=>{i.dataset.heroId&&R(i.dataset.heroId)})),document.querySelectorAll(".featured-hero").forEach(i=>i.addEventListener("click",()=>{i.dataset.heroId&&R(i.dataset.heroId)})),document.querySelectorAll(".ql-card, .ov-stat").forEach(i=>i.addEventListener("click",()=>{i.dataset.section&&A(i.dataset.section)}));const e=document.getElementById("ovSearch");e&&e.addEventListener("keydown",i=>{i.key==="Enter"&&P()});const o=document.getElementById("ovSearchBtn");o&&o.addEventListener("click",P);const l=document.getElementById("playerInput");l&&l.addEventListener("keydown",i=>{i.key==="Enter"&&I()});const n=document.getElementById("playerSearchBtn");n&&n.addEventListener("click",I);const s=document.getElementById("closeModalBtn");s&&s.addEventListener("click",L);const d=document.getElementById("heroModal");d&&d.addEventListener("click",i=>{i.target===d&&L()});const a=document.getElementById("playerModalClose");a&&a.addEventListener("click",B);const c=document.getElementById("playerModal");c&&c.addEventListener("click",i=>{i.target===c&&B()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&(L(),B())});const r=document.getElementById("themeToggle");r&&r.addEventListener("click",()=>C(document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark"));const v=document.getElementById("headerSearchBtn"),m=document.getElementById("headerSearchInput"),g=document.getElementById("headerSearch");v&&v.addEventListener("click",()=>{if(!g.classList.contains("open")){g.classList.add("open"),m.focus();return}const i=m?m.value.trim():"";i&&S(i)}),m&&m.addEventListener("keydown",i=>{if(i.key==="Enter"){const p=m.value.trim();p&&S(p)}i.key==="Escape"&&(g.classList.remove("open"),m.value="")});const h=document.getElementById("metaRefresh");h&&h.addEventListener("click",x),document.querySelectorAll("#metaTable thead th.sortable").forEach(i=>{i.addEventListener("click",()=>{const p=i.dataset.sort;f===p?E=E==="desc"?"asc":"desc":(f=p,E="desc"),z()})}),["metaRegion","metaMinBadge","metaHeroType"].forEach(i=>{const p=document.getElementById(i);p&&p.addEventListener("change",()=>{M&&x()})}),document.querySelectorAll(".region-btn").forEach(i=>i.addEventListener("click",()=>N(i.dataset.region)))}document.addEventListener("DOMContentLoaded",()=>{J(),X(),A(location.hash?location.hash.slice(1):"overview")});window.LockedIn={showHeroDetails:R,closeModal:L,searchPlayer:I,loadProfile:j,backToSearch:q,fetchHeroStats:x,overviewSearch:P,openPlayerModal:S,closePlayerModal:B,fetchLeaderboard:N};
