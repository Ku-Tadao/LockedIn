const V=document.getElementById("app-data"),Q=V?JSON.parse(V.dataset.payload||"{}"):{},M="https://api.deadlock-api.com",k={tierLoaded:!1,metaLoaded:!1,lbLoaded:!1,lbRegion:"Europe"},X=a=>(a||"").toString().toLowerCase().trim(),y=a=>String(a??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function j(a){document.documentElement.setAttribute("data-theme",a),localStorage.setItem("li-theme",a);const t=document.getElementById("themeToggle");t&&(t.textContent=a==="dark"?"Light Mode":"Dark Mode")}function Y(){const a=localStorage.getItem("li-theme");if(a){j(a);return}j(window.matchMedia?.("(prefers-color-scheme:dark)").matches?"dark":"light")}function Z(a){document.querySelectorAll(".nav-link").forEach(t=>t.classList.toggle("active",t.dataset.section===a))}function q(a){document.querySelectorAll("section.content").forEach(o=>{o.style.display="none"});const t=document.getElementById(a);t&&(t.style.display="",Z(a)),a==="heroes"&&!k.tierLoaded&&(k.tierLoaded=!0,te()),a==="stats"&&!k.metaLoaded&&(k.metaLoaded=!0,D()),a==="leaderboard"&&!k.lbLoaded&&(k.lbLoaded=!0,U(k.lbRegion))}function ee(a){const t=X(a);document.querySelectorAll(".hero-card").forEach(o=>{const r=o.dataset.heroName||"",i=o.dataset.heroType||"";o.style.display=!t||r.includes(t)||i.includes(t)?"":"none"})}async function te(){const a=document.getElementById("tierListBody");if(a)try{const t=await fetch(M+"/v1/analytics/hero-stats?min_badge_level=0");if(!t.ok)throw new Error("HTTP "+t.status);const o=await t.json();if(!o||!o.length){a.innerHTML='<div class="tier-list-loading">No tier data available.</div>';return}const r=o.map(s=>{const d=I(s.hero_id),n=s.matches||1;return{hero:d,hero_id:s.hero_id,win_rate:s.wins/n*100,matches:n}}).filter(s=>s.hero),i={S:[],A:[],B:[],C:[],D:[]};r.forEach(s=>{const d=ne(s.win_rate);i[d.l].push(s)}),Object.values(i).forEach(s=>s.sort((d,n)=>n.win_rate-d.win_rate));const e=[{key:"S",label:"S",cls:"tier-s",desc:"OP"},{key:"A",label:"A",cls:"tier-a",desc:"Strong"},{key:"B",label:"B",cls:"tier-b",desc:"Balanced"},{key:"C",label:"C",cls:"tier-c",desc:"Weak"},{key:"D",label:"D",cls:"tier-d",desc:"Dead"}];let c="";e.forEach(s=>{const d=i[s.key];c+='<div class="tier-row">',c+='<div class="tier-row-label '+s.cls+'"><span class="tier-row-letter">'+s.label+'</span><span class="tier-row-desc">'+s.desc+"</span></div>",c+='<div class="tier-row-heroes">',d.length===0?c+='<span class="tier-empty">No heroes</span>':d.forEach(n=>{const p=n.hero.images?.icon_hero_card_webp||n.hero.images?.icon_hero_card||n.hero.images?.icon_image_small_webp||"",u=n.hero.name,m="var(--"+(n.hero.hero_type||"")+", var(--muted))";c+='<button class="tier-hero" data-hero-id="'+n.hero_id+'" title="'+y(u)+" — "+n.win_rate.toFixed(1)+'% WR">',c+='<img src="'+p+'" alt="'+y(u)+'" loading="lazy"/>',c+='<span class="tier-hero-name">'+y(u)+"</span>",c+='<span class="tier-hero-wr" style="color:'+(n.win_rate>=50?"var(--accent)":m)+'">'+n.win_rate.toFixed(1)+"%</span>",c+="</button>"}),c+="</div></div>"}),a.innerHTML=c,a.querySelectorAll(".tier-hero").forEach(s=>{s.addEventListener("click",()=>{s.dataset.heroId&&C(s.dataset.heroId)})})}catch{a.innerHTML='<div class="tier-list-loading">Error loading tier data. Try refreshing.</div>'}}function I(a){return Q.heroes?.find(t=>String(t.id)===String(a))}function C(a){const t=I(a);if(!t)return;const o=document.getElementById("heroModal");document.getElementById("modalHeroName").textContent="";const r=document.getElementById("modalHeroDetails");r.innerHTML="",o.classList.remove("hidden"),o.setAttribute("aria-hidden","false");const i="var(--"+(t.hero_type||"brand")+")";let e="";const c=t.images?.icon_hero_card_webp||t.images?.icon_hero_card||"";e+='<div class="hd-header">',e+='<img class="hd-portrait" src="'+c+'" alt="'+y(t.name)+'" />',e+='<div class="hd-info">',e+='<h2 class="hd-name">'+y(t.name)+"</h2>",e+='<span class="hd-type-pill '+(t.hero_type||"")+'">'+y(t.hero_type||"Unknown")+"</span>";const s=t.description;if(s&&(typeof s=="object"?(s.role&&(e+='<p class="hd-desc"><strong>'+y(s.role)+"</strong></p>"),s.playstyle&&(e+='<p class="hd-desc">'+y(s.playstyle)+"</p>")):e+='<p class="hd-desc">'+y(s)+"</p>"),t.tags&&t.tags.length&&(e+='<div class="hd-tags">',t.tags.forEach(n=>{e+='<span class="hd-tag">'+y(n)+"</span>"}),e+="</div>"),e+="</div></div>",t.complexity){e+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Complexity</h4></div>',e+='<div style="display:flex;gap:4px;margin-bottom:1rem">';for(let n=1;n<=4;n++){const p=n<=t.complexity;e+='<span style="width:24px;height:8px;border-radius:4px;background:'+(p?i:"var(--surface-strong)")+'"></span>'}e+="</div></div>"}const d=n=>n!=null&&typeof n=="object"&&"value"in n?n.value:n;if(t.starting_stats){const n=t.starting_stats,p=t.standard_level_up_upgrades||{},u=v=>v&&v!==0?'<span class="bs-per-level">+'+v+"</span>":"",g=(v,B,P)=>'<div class="bs-row"><span class="bs-label">'+y(v)+'</span><span class="bs-value">'+B+(P||"")+"</span></div>",m=(v,B)=>'<div class="bs-row"><span class="bs-label">'+y(v)+'</span><span class="bs-value" data-bs="'+B+'">—</span></div>',h=t.shop_stat_display?.weapon_stats_display,b={EWeaponAttribute_RapidFire:"Rapid Fire",EWeaponAttribute_MediumRange:"Medium Range",EWeaponAttribute_LongRange:"Long Range",EWeaponAttribute_ShortRange:"Short Range",EWeaponAttribute_SemiAutomatic:"Semi-Auto",EWeaponAttribute_FullAutomatic:"Full Auto",EWeaponAttribute_BurstFire:"Burst Fire",EWeaponAttribute_HeavyHitter:"Heavy Hitter",EWeaponAttribute_Projectile:"Projectile"};e+='<div class="hd-basestats"><h4>Base Stats</h4>',e+='<div class="bs-columns">',e+='<div class="bs-column"><div class="bs-col-head weapon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><path d="M20.2 20.2l-2.8-2.8M3.8 3.8l2.8 2.8M6.6 17.4l-2.8 2.8M17.4 6.6l2.8-2.8"/></svg>Weapon Stats</div>',h&&h.weapon_attributes&&h.weapon_attributes.length&&(e+='<div class="bs-tags">',h.weapon_attributes.forEach(v=>{e+='<span class="bs-tag">'+y(b[v]||v.replace(/EWeaponAttribute_/g,"").replace(/_/g," "))+"</span>"}),e+="</div>"),e+='<div class="bs-list">',e+=m("DPS","weapon-dps"),e+=m("Bullet Damage","weapon-bdmg"),e+=m("Ammo","weapon-ammo"),e+=m("Bullets/sec","weapon-bps"),e+=m("Reload Time","weapon-reload");const l=p.MODIFIER_VALUE_BASE_MELEE_DAMAGE_FROM_LEVEL;e+=g("Light Melee",d(n.light_melee_damage),u(l)),e+=g("Heavy Melee",d(n.heavy_melee_damage),u(l)),e+="</div>",h&&(h.weapon_image_webp||h.weapon_image)&&(e+='<div class="bs-weapon-img"><img src="'+(h.weapon_image_webp||h.weapon_image)+'" alt="Weapon" loading="lazy"/></div>'),e+="</div>",e+='<div class="bs-column"><div class="bs-col-head vitality"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"/></svg>Vitality Stats</div>',e+='<div class="bs-list">',e+=g("Health",d(n.max_health),u(p.MODIFIER_VALUE_BASE_HEALTH_FROM_LEVEL)),e+=g("Health Regen",d(n.base_health_regen??n.health_regen));const f=d(n.bullet_armor_damage_reduction??n.bullet_armor)||0;e+=g("Bullet Resist",f+"%",u(p.MODIFIER_VALUE_BULLET_ARMOR_DAMAGE_RESIST));const E=d(n.tech_armor_damage_reduction??n.spirit_armor)||0;e+=g("Spirit Resist",E+"%",u(p.MODIFIER_VALUE_TECH_ARMOR_DAMAGE_RESIST)),e+=g("Move Speed",d(n.max_move_speed??n.move_speed)+"m/s"),d(n.sprint_speed)&&(e+=g("Sprint Speed",d(n.sprint_speed)+"m/s")),e+=g("Stamina",d(n.stamina));const w=d(n.stamina_regen_per_second);w&&w>0&&(e+=g("Stamina Cooldown",(1/w).toFixed(1)+"s")),e+="</div></div>",e+='<div class="bs-column"><div class="bs-col-head spirit"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>Spirit Stats</div>',e+='<div class="bs-list">',e+=g("Spirit Power","0",u(p.MODIFIER_VALUE_TECH_POWER)),e+="</div></div>",e+="</div></div>"}if(t.items&&typeof t.items=="object"){const n=Object.keys(t.items).filter(p=>p.startsWith("signature"));n.length&&(e+='<div class="hd-abilities-section"><h4>Abilities</h4>',e+='<div id="abilities-container">',n.sort().forEach(()=>{e+='<div class="ability-box ability-skeleton"><div class="ability-header"><div class="skeleton-circle"></div><div class="skeleton-lines"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div></div></div>'}),e+="</div></div>")}if(r.innerHTML=e,t.items&&typeof t.items=="object"){const n=Object.keys(t.items).filter(p=>p.startsWith("signature")).sort();n.length&&ae(t,n)}}let W=null;async function ae(a,t){const o=document.getElementById("abilities-container");if(o)try{if(!W){const s=await fetch("https://assets.deadlock-api.com/v2/items");if(!s.ok)throw new Error("HTTP "+s.status);W=await s.json()}const r=W,i={};(Array.isArray(r)?r:[]).forEach(s=>{i[s.class_name]=s});let e="";t.forEach((s,d)=>{const n=a.items[s],p=i[n];if(!p){const v=A(n);e+='<div class="ability-box"><div class="ability-header"><span class="ability-name">'+y(v)+"</span></div></div>";return}const u=p.name||A(n),g=p.image_webp||p.image||"",m=p.properties?.AbilityCooldown?.value,h=p.properties?.AbilityDuration?.value,b=p.properties?.AbilityCastRange?.value,l=p.description;let f="";if(l&&typeof l=="object"){const v=p.tooltip_details;v&&v.info_sections&&v.info_sections.length&&v.info_sections[0].loc_string?f=v.info_sections[0].loc_string:f=l.desc||l.quip||""}else typeof l=="string"&&(f=l);const E=p.ability_type==="ultimate",w=p.upgrades||[];if(e+='<div class="ability-box'+(E?" ability-ultimate":"")+'">',e+='<div class="ability-header">',e+='<div class="ability-header-left">',g&&(e+='<img class="ability-image" src="'+g+'" alt="'+y(u)+'" loading="lazy"/>'),e+='<div class="ability-title-group">',e+='<span class="ability-name">'+y(u)+"</span>",e+='<span class="ability-slot'+(E?" ult":"")+'">'+(E?"Ultimate":"Ability "+(d+1))+"</span>",e+="</div></div>",e+='<div class="ability-stats">',m&&m!=="0"&&m!==0&&(e+='<span class="ability-stat cd" title="Cooldown"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>'+m+"s</span>"),h&&h!=="0"&&h!==0&&(e+='<span class="ability-stat dur" title="Duration"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M12 8v4l2 2"/></svg>'+h+"s</span>"),b&&b!=="0"&&b!==0&&b!=="0m"&&(e+='<span class="ability-stat rng" title="Cast Range"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>'+b+"</span>"),e+="</div></div>",f){let v=f;v=v.replace(/<svg[^>]*>[\s\S]*?<\/svg>\s*/gi,""),v=v.replace(/\{g:citadel_binding:'([^']*)'\}/g,"[$1]"),v=v.replace(/<span class="inline-attribute-label[^"]*"[^>]*>/gi,""),v=v.replace(/\{s:sign\}/gi,"+"),v=v.replace(/\n+/g," ").replace(/\s{2,}/g," ").trim(),v&&(e+='<div class="ability-details"><div class="ability-desc">'+v+"</div></div>")}w.length&&(e+='<div class="ability-upgrades">',w.forEach((v,B)=>{if(!v.property_upgrades||!v.property_upgrades.length)return;const P=B+1,K=v.property_upgrades.map(z=>{const $=A(z.name||""),S=z.bonus;return(typeof S=="number"&&S>0||typeof S=="string"&&!S.startsWith("-")&&!S.startsWith("+")?"+":"")+S+" "+$}).join(", ");e+='<div class="ability-tier"><span class="tier-badge">T'+P+'</span><span class="tier-text">'+y(K)+"</span></div>"}),e+="</div>"),e+="</div>"}),o.innerHTML=e;const c=a.items?.weapon_primary;if(c&&i[c]){const s=i[c].weapon_info;if(s){const d=(g,m)=>{const h=document.querySelector('[data-bs="'+g+'"]');h&&(h.innerHTML=m)},n=a.standard_level_up_upgrades||{},p=g=>g&&g!==0?'<span class="bs-per-level">+'+g+"</span>":"";s.damage_per_second!=null&&d("weapon-dps",s.damage_per_second.toFixed(1));const u=s.bullet_damage??s.damage_per_shot;u!=null&&d("weapon-bdmg",(+u).toFixed(1)+p(n.MODIFIER_VALUE_BASE_BULLET_DAMAGE_FROM_LEVEL)),s.clip_size!=null&&d("weapon-ammo",s.clip_size),s.bullets_per_second!=null&&d("weapon-bps",s.bullets_per_second.toFixed(2)),s.reload_duration!=null&&d("weapon-reload",s.reload_duration.toFixed(2)+"s")}}}catch(r){console.warn("Failed to fetch ability details:",r);let i="";t.forEach(e=>{const c=A(a.items[e]);i+='<div class="ability-box"><div class="ability-header"><span class="ability-name">'+y(c)+"</span></div></div>"}),o.innerHTML=i}}function A(a){return String(a||"").replace(/^(ability_|citadel_ability_)/i,"").replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}function T(){const a=document.getElementById("heroModal");a.classList.add("hidden"),a.setAttribute("aria-hidden","true")}function H(a){const t=document.getElementById("playerModal");if(!t)return;t.classList.remove("hidden");const o=document.getElementById("playerInput");o&&a?(o.value=a,R()):o&&!a&&o.focus()}function x(){const a=document.getElementById("playerModal");if(!a)return;a.classList.add("hidden");const t=document.getElementById("playerSearchResults"),o=document.getElementById("playerProfile");t&&(t.innerHTML=""),o&&(o.innerHTML="",o.classList.add("hidden"))}function N(){const a=document.getElementById("ovSearch");if(!a)return;const t=a.value.trim();t&&H(t)}async function R(){const a=document.getElementById("playerInput"),t=document.getElementById("playerSearchResults"),o=document.getElementById("playerProfile");if(!a||!t)return;const r=a.value.trim();if(!r){t.innerHTML='<div class="status">Enter a Steam username.</div>';return}t.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Searching...</div>',t.classList.remove("hidden"),o&&o.classList.add("hidden");try{const i=await fetch(M+"/v1/players/steam-search?username="+encodeURIComponent(r));if(!i.ok)throw new Error("HTTP "+i.status);const e=await i.json();if(!e||!e.length){t.innerHTML='<div class="status">No players found for "'+y(r)+'".</div>';return}t.innerHTML='<div class="search-results-header"><h3>'+e.length+" player"+(e.length!==1?"s":"")+' found</h3></div><div class="player-results-grid">'+e.slice(0,20).map(c=>'<div class="player-result-card" data-pid="'+y(c.account_id||c.steam_id)+'"><img class="player-result-avatar" src="'+(c.avatar_url||c.avatar||"")+`" alt="" loading="lazy" onerror="this.style.display='none'" /><div class="player-result-info"><h4>`+y(c.persona_name||c.name||"Unknown")+"</h4><p>"+y(c.account_id||c.steam_id||"")+"</p></div></div>").join("")+"</div>",t.querySelectorAll(".player-result-card").forEach(c=>c.addEventListener("click",()=>G(c.dataset.pid)))}catch{t.innerHTML='<div class="status">Search error. Please try again.</div>'}}async function G(a){const t=document.getElementById("playerSearchResults"),o=document.getElementById("playerProfile");if(o){o.classList.remove("hidden"),o.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Loading profile...</div>',t&&t.classList.add("hidden");try{const[r,i]=await Promise.allSettled([fetch(M+"/v1/players/"+encodeURIComponent(a)+"/match-history?limit=20"),fetch(M+"/v1/players/"+encodeURIComponent(a)+"/mmr-history")]),e=r.status==="fulfilled"&&r.value.ok?await r.value.json():null,c=i.status==="fulfilled"&&i.value.ok?await i.value.json():null;let s='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back to results</button>';if(s+='<div class="player-profile-header">',s+='<div class="player-profile-info"><h3>Player '+y(a)+"</h3>",c&&c.length){const d=c[c.length-1];d.badge_level!=null&&(s+="<p>Current Badge Level: <strong>"+d.badge_level+"</strong></p>")}if(s+="</div></div>",e&&e.length){let d=0,n=0;e.forEach(m=>{m.match_result==="Win"||m.player_team_won?d++:n++});const p=e.length>0?d/e.length*100:0;s+='<h4 class="sub-title">Recent Matches ('+e.length+")</h4>",s+='<div class="donut-container">'+se(p)+'<div class="donut-stats-side"><div class="ds-row"><span class="ds-label">Matches</span><span class="ds-value">'+e.length+'</span></div><div class="ds-row"><span class="ds-label">Wins</span><span class="ds-value" style="color:var(--accent)">'+d+'</span></div><div class="ds-row"><span class="ds-label">Losses</span><span class="ds-value" style="color:var(--brawler)">'+n+"</span></div></div></div>";const u={};e.forEach(m=>{const h=m.hero_id;h&&(u[h]||(u[h]={count:0,wins:0}),u[h].count++,(m.match_result==="Win"||m.player_team_won)&&u[h].wins++)});const g=Object.entries(u).sort((m,h)=>h[1].count-m[1].count).slice(0,8);if(g.length){const m=g[0][1].count;s+='<h4 class="sub-title">Most Played Heroes</h4><div class="hero-time-list">',g.forEach(([h,b])=>{const l=I(h),f=l?.images?.icon_image_small_webp||l?.images?.icon_image_small||"",E=l?.name||"Hero #"+h,w=m>0?b.count/m*100:0,v=b.count>0?b.wins/b.count*100:0,B=v>=50?"var(--accent)":"var(--brawler)";s+='<div class="hero-time-row">'+(f?'<img src="'+f+'" alt="" loading="lazy"/>':"<div></div>")+'<div><span class="htb-name">'+y(E)+'</span><div class="htb-bar"><div class="htb-bar-fill" style="width:'+w.toFixed(1)+'%"></div></div></div><span class="hero-time-stats"><span style="color:'+B+'">'+v.toFixed(0)+"%</span> · "+b.count+" games</span></div>"}),s+="</div>"}}else s+='<div class="status">No match history available or profile is private.</div>';o.innerHTML=s,document.getElementById("backBtn")?.addEventListener("click",O)}catch{o.innerHTML='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back</button><div class="status">Error loading profile.</div>',document.getElementById("backBtn")?.addEventListener("click",O)}}}function O(){const a=document.getElementById("playerSearchResults"),t=document.getElementById("playerProfile");a&&a.classList.remove("hidden"),t&&t.classList.add("hidden")}function se(a){const o=a/100*251.2,r=a>=50?"var(--accent)":"var(--brawler)";return'<div class="donut-chart"><svg viewBox="0 0 90 90"><circle class="donut-ring" cx="45" cy="45" r="40"/><circle class="donut-segment" cx="45" cy="45" r="40" stroke="'+r+'" stroke-dasharray="'+o.toFixed(1)+" "+251.2+'"/></svg><div class="donut-label"><span class="donut-value" style="color:'+r+'">'+a.toFixed(1)+'%</span><span class="donut-desc">Win Rate</span></div></div>'}let _="winrate",L="desc",F=null;function ne(a){return a>=55?{l:"S",c:"tier-s"}:a>=52?{l:"A",c:"tier-a"}:a>=49?{l:"B",c:"tier-b"}:a>=46?{l:"C",c:"tier-c"}:{l:"D",c:"tier-d"}}async function D(){const a=document.getElementById("metaStatus"),t=document.getElementById("metaBody");if(!t)return;a&&(a.textContent="Loading hero stats..."),t.innerHTML='<tr><td colspan="8"><div class="meta-empty" style="animation:pulse 1.5s infinite"><p>Loading...</p></div></td></tr>';const o=document.getElementById("metaMinBadge")?.value||"0",r=document.getElementById("metaHeroType")?.value||"";let i=M+"/v1/analytics/hero-stats?min_badge_level="+o;try{const e=await fetch(i);if(!e.ok)throw new Error("HTTP "+e.status);const c=await e.json();if(!c||!c.length){t.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>No stats available.</p></div></td></tr>',a&&(a.textContent="No data found");return}const s=c.reduce((n,p)=>n+(p.matches||0),0);let d=c.map(n=>{const p=I(n.hero_id),u=n.matches||1;return{...n,hero:p,hero_type:p?.hero_type||"",win_rate:n.wins/u,pick_rate:s>0?u/s:0,avg_kills:(n.total_kills||0)/u,avg_deaths:(n.total_deaths||0)/u,avg_assists:(n.total_assists||0)/u}});r&&(d=d.filter(n=>n.hero_type===r)),F=d,_="winrate",L="desc",J(),a&&(a.textContent="Showing "+d.length+" heroes")}catch{t.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>Error loading stats. Try again.</p></div></td></tr>',a&&(a.textContent="Error loading stats")}}function J(){if(!F)return;const a=F.slice().sort((t,o)=>{let r,i;return _==="hero"?(r=(t.hero?.name||"").toLowerCase(),i=(o.hero?.name||"").toLowerCase(),L==="asc"?r.localeCompare(i):i.localeCompare(r)):_==="type"?(r=t.hero_type,i=o.hero_type,L==="asc"?r.localeCompare(i):i.localeCompare(r)):(_==="winrate"?(r=t.win_rate??t.winrate??0,i=o.win_rate??o.winrate??0):_==="pickrate"?(r=t.pick_rate??t.pickrate??0,i=o.pick_rate??o.pickrate??0):_==="matches"?(r=t.total_matches??t.matches??0,i=o.total_matches??o.matches??0):_==="kills"?(r=t.avg_kills??t.kills??0,i=o.avg_kills??o.kills??0):_==="deaths"?(r=t.avg_deaths??t.deaths??0,i=o.avg_deaths??o.deaths??0):_==="assists"?(r=t.avg_assists??t.assists??0,i=o.avg_assists??o.assists??0):(r=0,i=0),L==="asc"?r-i:i-r)});ie(a)}function ie(a){const t=document.getElementById("metaBody");if(!t)return;document.querySelectorAll("#metaTable thead th.sortable").forEach(i=>{const e=i.dataset.sort;i.classList.toggle("sort-active",e===_);const c=i.querySelector(".sort-arrow");if(c&&c.remove(),e===_){const s=document.createElement("span");s.className="sort-arrow",s.textContent=L==="asc"?" ▲":" ▼",i.appendChild(s)}});const o=Math.max(...a.map(i=>i.pick_rate??i.pickrate??0));let r="";a.forEach(i=>{const e=i.hero,c=e?.images?.icon_image_small_webp||e?.images?.icon_image_small||"",s=e?.name||"Hero #"+i.hero_id,d=i.hero_type||"unknown",n="var(--"+d+", var(--muted))",p=i.win_rate??i.winrate??0,u=i.pick_rate??i.pickrate??0,g=i.total_matches??i.matches??0,m=i.avg_kills??i.kills??0,h=i.avg_deaths??i.deaths??0,b=i.avg_assists??i.assists??0,l=(p*100).toFixed(1),f=(u*100).toFixed(2),E=o>0?u/o*100:0,w=p>=.5?"var(--accent)":"var(--brawler)";r+='<tr><td><div class="meta-hero-cell">'+(c?'<img class="meta-hero-portrait" src="'+c+'" alt="" loading="lazy"/>':"")+"<span>"+y(s)+'</span></div></td><td><span style="color:'+n+';font-weight:600;text-transform:capitalize;font-family:Chakra Petch,system-ui,sans-serif;font-size:.78rem">'+y(d)+'</span></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill winrate" style="width:'+l+"%;background:"+w+'"></div></div><span class="stat-value-label">'+l+'%</span></div></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill pickrate" style="width:'+E.toFixed(1)+'%"></div></div><span class="stat-value-label">'+f+"%</span></div></td><td>"+g.toLocaleString()+"</td><td>"+(typeof m=="number"?m.toFixed(1):m)+"</td><td>"+(typeof h=="number"?h.toFixed(1):h)+"</td><td>"+(typeof b=="number"?b.toFixed(1):b)+"</td></tr>"}),t.innerHTML=r||'<tr><td colspan="8"><div class="meta-empty"><p>No data.</p></div></td></tr>'}async function U(a){k.lbRegion=a;const t=document.getElementById("lbStatus"),o=document.getElementById("lbBody");if(o){t&&(t.textContent="Loading "+a+" leaderboard..."),o.innerHTML='<tr class="lb-placeholder"><td colspan="5"><div class="lb-empty"><div class="loading-dots"><span></span><span></span><span></span></div><p>Loading...</p></div></td></tr>',document.querySelectorAll(".region-btn").forEach(r=>r.classList.toggle("active",r.dataset.region===a));try{const r=await fetch(M+"/v1/leaderboard/"+encodeURIComponent(a));if(!r.ok)throw new Error("HTTP "+r.status);const i=await r.json(),e=Array.isArray(i)?i:i.entries||[];if(!e||!e.length){o.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>No leaderboard data available.</p></div></td></tr>',t&&(t.textContent="No data for "+a);return}let c="";e.slice(0,100).forEach(s=>{const d=s.rank??"-",n=typeof d=="number"?d:0,p=n===1?"top-1":n===2?"top-2":n===3?"top-3":"",u=s.account_name||"Unknown",g=s.badge_level??"-",m=s.ranked_rank!=null?s.ranked_rank:"-",h=s.ranked_subrank!=null?s.ranked_subrank:"",b=m!=="-"?m+(h?"."+h:""):"-";let l="-";s.top_hero_ids&&s.top_hero_ids.length&&(l=s.top_hero_ids.slice(0,3).map(f=>{const E=I(f);return E?y(E.name):"Hero #"+f}).join(", ")),c+='<tr><td class="lb-rank-cell '+p+'">'+d+'</td><td class="lb-player-cell"><span>'+y(u)+'</span></td><td class="lb-badge-cell">'+g+"</td><td>"+b+"</td><td>"+l+"</td></tr>"}),o.innerHTML=c,t&&(t.textContent="Showing top "+Math.min(e.length,100)+" players in "+a)}catch{o.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>Error loading leaderboard.</p></div></td></tr>',t&&(t.textContent="Error loading leaderboard")}}}function oe(){document.querySelectorAll(".nav-link").forEach(l=>l.addEventListener("click",()=>q(l.dataset.section)));const a=document.getElementById("heroSearch");a&&a.addEventListener("input",l=>ee(l.target.value)),document.querySelectorAll(".hero-card").forEach(l=>l.addEventListener("click",()=>{l.dataset.heroId&&C(l.dataset.heroId)})),document.querySelectorAll(".featured-hero").forEach(l=>l.addEventListener("click",()=>{l.dataset.heroId&&C(l.dataset.heroId)})),document.querySelectorAll(".ql-card, .ov-stat").forEach(l=>l.addEventListener("click",()=>{l.dataset.section&&q(l.dataset.section)}));const t=document.getElementById("ovSearch");t&&t.addEventListener("keydown",l=>{l.key==="Enter"&&N()});const o=document.getElementById("ovSearchBtn");o&&o.addEventListener("click",N);const r=document.getElementById("playerInput");r&&r.addEventListener("keydown",l=>{l.key==="Enter"&&R()});const i=document.getElementById("playerSearchBtn");i&&i.addEventListener("click",R);const e=document.getElementById("closeModalBtn");e&&e.addEventListener("click",T);const c=document.getElementById("heroModal");c&&c.addEventListener("click",l=>{l.target===c&&T()});const s=document.getElementById("playerModalClose");s&&s.addEventListener("click",x);const d=document.getElementById("playerModal");d&&d.addEventListener("click",l=>{l.target===d&&x()}),document.addEventListener("keydown",l=>{l.key==="Escape"&&(T(),x())});const n=document.getElementById("themeToggle");n&&n.addEventListener("click",()=>j(document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark"));const p=document.getElementById("productSwitcherBtn"),u=document.getElementById("productSwitcherDropdown");p&&u&&(p.addEventListener("click",l=>{l.stopPropagation(),u.classList.toggle("hidden")}),document.addEventListener("click",l=>{!u.contains(l.target)&&l.target!==p&&u.classList.add("hidden")}));const g=document.getElementById("headerSearchBtn"),m=document.getElementById("headerSearchInput"),h=document.getElementById("headerSearch");g&&g.addEventListener("click",()=>{if(!h.classList.contains("open")){h.classList.add("open"),m.focus();return}const l=m?m.value.trim():"";l&&H(l)}),m&&m.addEventListener("keydown",l=>{if(l.key==="Enter"){const f=m.value.trim();f&&H(f)}l.key==="Escape"&&(h.classList.remove("open"),m.value="")});const b=document.getElementById("metaRefresh");b&&b.addEventListener("click",D),document.querySelectorAll("#metaTable thead th.sortable").forEach(l=>{l.addEventListener("click",()=>{const f=l.dataset.sort;_===f?L=L==="desc"?"asc":"desc":(_=f,L="desc"),J()})}),["metaRegion","metaMinBadge","metaHeroType"].forEach(l=>{const f=document.getElementById(l);f&&f.addEventListener("change",()=>{F&&D()})}),document.querySelectorAll(".region-btn").forEach(l=>l.addEventListener("click",()=>U(l.dataset.region)))}document.addEventListener("DOMContentLoaded",()=>{"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.scrollTo(0,0),Y(),oe(),q("overview")});window.LockedIn={showHeroDetails:C,closeModal:T,searchPlayer:R,loadProfile:G,backToSearch:O,fetchHeroStats:D,overviewSearch:N,openPlayerModal:H,closePlayerModal:x,fetchLeaderboard:U};
