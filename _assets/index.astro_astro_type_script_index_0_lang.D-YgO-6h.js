const V=document.getElementById("app-data"),Q=V?JSON.parse(V.dataset.payload||"{}"):{},I="https://api.deadlock-api.com",M={metaLoaded:!1,lbLoaded:!1,lbRegion:"Europe"},X=s=>(s||"").toString().toLowerCase().trim(),y=s=>String(s??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function W(s){document.documentElement.setAttribute("data-theme",s),localStorage.setItem("li-theme",s);const t=document.getElementById("themeToggle");t&&(t.textContent=s==="dark"?"Light Mode":"Dark Mode")}function Y(){const s=localStorage.getItem("li-theme");if(s){W(s);return}W(window.matchMedia?.("(prefers-color-scheme:dark)").matches?"dark":"light")}function Z(s){document.querySelectorAll(".nav-link").forEach(t=>t.classList.toggle("active",t.dataset.section===s))}function j(s){document.querySelectorAll("section.content").forEach(l=>{l.style.display="none"});const t=document.getElementById(s);t&&(t.style.display="",Z(s)),s==="stats"&&!M.metaLoaded&&(M.metaLoaded=!0,H()),s==="leaderboard"&&!M.lbLoaded&&(M.lbLoaded=!0,O(M.lbRegion))}function ee(s){const t=X(s);document.querySelectorAll(".hero-card").forEach(l=>{const r=l.dataset.heroName||"",a=l.dataset.heroType||"";l.style.display=!t||r.includes(t)||a.includes(t)?"":"none"})}function F(s){return Q.heroes?.find(t=>String(t.id)===String(s))}function q(s){const t=F(s);if(!t)return;const l=document.getElementById("heroModal");document.getElementById("modalHeroName").textContent="";const r=document.getElementById("modalHeroDetails");r.innerHTML="",l.classList.remove("hidden"),l.setAttribute("aria-hidden","false");const a="var(--"+(t.hero_type||"brand")+")";let e="";const d=t.images?.icon_hero_card_webp||t.images?.icon_hero_card||"";e+='<div class="hd-header">',e+='<img class="hd-portrait" src="'+d+'" alt="'+y(t.name)+'" />',e+='<div class="hd-info">',e+='<h2 class="hd-name">'+y(t.name)+"</h2>",e+='<span class="hd-type-pill '+(t.hero_type||"")+'">'+y(t.hero_type||"Unknown")+"</span>";const i=t.description;if(i&&(typeof i=="object"?(i.role&&(e+='<p class="hd-desc"><strong>'+y(i.role)+"</strong></p>"),i.playstyle&&(e+='<p class="hd-desc">'+y(i.playstyle)+"</p>")):e+='<p class="hd-desc">'+y(i)+"</p>"),t.tags&&t.tags.length&&(e+='<div class="hd-tags">',t.tags.forEach(o=>{e+='<span class="hd-tag">'+y(o)+"</span>"}),e+="</div>"),e+="</div></div>",t.complexity){e+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Complexity</h4></div>',e+='<div style="display:flex;gap:4px;margin-bottom:1rem">';for(let o=1;o<=4;o++){const p=o<=t.complexity;e+='<span style="width:24px;height:8px;border-radius:4px;background:'+(p?a:"var(--surface-strong)")+'"></span>'}e+="</div></div>"}const c=o=>o!=null&&typeof o=="object"&&"value"in o?o.value:o;if(t.starting_stats){const o=t.starting_stats,p=t.standard_level_up_upgrades||{},v=h=>h&&h!==0?'<span class="bs-per-level">+'+h+"</span>":"",g=(h,L,P)=>'<div class="bs-row"><span class="bs-label">'+y(h)+'</span><span class="bs-value">'+L+(P||"")+"</span></div>",m=(h,L)=>'<div class="bs-row"><span class="bs-label">'+y(h)+'</span><span class="bs-value" data-bs="'+L+'">—</span></div>',u=t.shop_stat_display?.weapon_stats_display,b={EWeaponAttribute_RapidFire:"Rapid Fire",EWeaponAttribute_MediumRange:"Medium Range",EWeaponAttribute_LongRange:"Long Range",EWeaponAttribute_ShortRange:"Short Range",EWeaponAttribute_SemiAutomatic:"Semi-Auto",EWeaponAttribute_FullAutomatic:"Full Auto",EWeaponAttribute_BurstFire:"Burst Fire",EWeaponAttribute_HeavyHitter:"Heavy Hitter",EWeaponAttribute_Projectile:"Projectile"};e+='<div class="hd-basestats"><h4>Base Stats</h4>',e+='<div class="bs-columns">',e+='<div class="bs-column"><div class="bs-col-head weapon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><path d="M20.2 20.2l-2.8-2.8M3.8 3.8l2.8 2.8M6.6 17.4l-2.8 2.8M17.4 6.6l2.8-2.8"/></svg>Weapon Stats</div>',u&&u.weapon_attributes&&u.weapon_attributes.length&&(e+='<div class="bs-tags">',u.weapon_attributes.forEach(h=>{e+='<span class="bs-tag">'+y(b[h]||h.replace(/EWeaponAttribute_/g,"").replace(/_/g," "))+"</span>"}),e+="</div>"),e+='<div class="bs-list">',e+=m("DPS","weapon-dps"),e+=m("Bullet Damage","weapon-bdmg"),e+=m("Ammo","weapon-ammo"),e+=m("Bullets/sec","weapon-bps"),e+=m("Reload Time","weapon-reload");const n=p.MODIFIER_VALUE_BASE_MELEE_DAMAGE_FROM_LEVEL;e+=g("Light Melee",c(o.light_melee_damage),v(n)),e+=g("Heavy Melee",c(o.heavy_melee_damage),v(n)),e+="</div>",u&&(u.weapon_image_webp||u.weapon_image)&&(e+='<div class="bs-weapon-img"><img src="'+(u.weapon_image_webp||u.weapon_image)+'" alt="Weapon" loading="lazy"/></div>'),e+="</div>",e+='<div class="bs-column"><div class="bs-col-head vitality"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z"/></svg>Vitality Stats</div>',e+='<div class="bs-list">',e+=g("Health",c(o.max_health),v(p.MODIFIER_VALUE_BASE_HEALTH_FROM_LEVEL)),e+=g("Health Regen",c(o.base_health_regen??o.health_regen));const f=c(o.bullet_armor_damage_reduction??o.bullet_armor)||0;e+=g("Bullet Resist",f+"%",v(p.MODIFIER_VALUE_BULLET_ARMOR_DAMAGE_RESIST));const E=c(o.tech_armor_damage_reduction??o.spirit_armor)||0;e+=g("Spirit Resist",E+"%",v(p.MODIFIER_VALUE_TECH_ARMOR_DAMAGE_RESIST)),e+=g("Move Speed",c(o.max_move_speed??o.move_speed)+"m/s"),c(o.sprint_speed)&&(e+=g("Sprint Speed",c(o.sprint_speed)+"m/s")),e+=g("Stamina",c(o.stamina));const w=c(o.stamina_regen_per_second);w&&w>0&&(e+=g("Stamina Cooldown",(1/w).toFixed(1)+"s")),e+="</div></div>",e+='<div class="bs-column"><div class="bs-col-head spirit"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>Spirit Stats</div>',e+='<div class="bs-list">',e+=g("Spirit Power","0",v(p.MODIFIER_VALUE_TECH_POWER)),e+="</div></div>",e+="</div></div>"}if(t.items&&typeof t.items=="object"){const o=Object.keys(t.items).filter(p=>p.startsWith("signature"));o.length&&(e+='<div class="hd-abilities-section"><h4>Abilities</h4>',e+='<div id="abilities-container">',o.sort().forEach(()=>{e+='<div class="ability-box ability-skeleton"><div class="ability-header"><div class="skeleton-circle"></div><div class="skeleton-lines"><div class="skeleton-line"></div><div class="skeleton-line short"></div></div></div></div>'}),e+="</div></div>")}if(r.innerHTML=e,t.items&&typeof t.items=="object"){const o=Object.keys(t.items).filter(p=>p.startsWith("signature")).sort();o.length&&te(t,o)}}let D=null;async function te(s,t){const l=document.getElementById("abilities-container");if(l)try{if(!D){const i=await fetch("https://assets.deadlock-api.com/v2/items");if(!i.ok)throw new Error("HTTP "+i.status);D=await i.json()}const r=D,a={};(Array.isArray(r)?r:[]).forEach(i=>{a[i.class_name]=i});let e="";t.forEach((i,c)=>{const o=s.items[i],p=a[o];if(!p){const h=S(o);e+='<div class="ability-box"><div class="ability-header"><span class="ability-name">'+y(h)+"</span></div></div>";return}const v=p.name||S(o),g=p.image_webp||p.image||"",m=p.properties?.AbilityCooldown?.value,u=p.properties?.AbilityDuration?.value,b=p.properties?.AbilityCastRange?.value,n=p.description;let f="";if(n&&typeof n=="object"){const h=p.tooltip_details;h&&h.info_sections&&h.info_sections.length&&h.info_sections[0].loc_string?f=h.info_sections[0].loc_string:f=n.desc||n.quip||""}else typeof n=="string"&&(f=n);const E=p.ability_type==="ultimate",w=p.upgrades||[];if(e+='<div class="ability-box'+(E?" ability-ultimate":"")+'">',e+='<div class="ability-header">',e+='<div class="ability-header-left">',g&&(e+='<img class="ability-image" src="'+g+'" alt="'+y(v)+'" loading="lazy"/>'),e+='<div class="ability-title-group">',e+='<span class="ability-name">'+y(v)+"</span>",e+='<span class="ability-slot'+(E?" ult":"")+'">'+(E?"Ultimate":"Ability "+(c+1))+"</span>",e+="</div></div>",e+='<div class="ability-stats">',m&&m!=="0"&&m!==0&&(e+='<span class="ability-stat cd" title="Cooldown"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>'+m+"s</span>"),u&&u!=="0"&&u!==0&&(e+='<span class="ability-stat dur" title="Duration"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M12 8v4l2 2"/></svg>'+u+"s</span>"),b&&b!=="0"&&b!==0&&b!=="0m"&&(e+='<span class="ability-stat rng" title="Cast Range"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>'+b+"</span>"),e+="</div></div>",f){let h=f;h=h.replace(/<svg[^>]*>[\s\S]*?<\/svg>\s*/gi,""),h=h.replace(/\{g:citadel_binding:'([^']*)'\}/g,"[$1]"),h=h.replace(/<span class="inline-attribute-label[^"]*"[^>]*>/gi,""),h=h.replace(/\{s:sign\}/gi,"+"),h=h.replace(/\n+/g," ").replace(/\s{2,}/g," ").trim(),h&&(e+='<div class="ability-details"><div class="ability-desc">'+h+"</div></div>")}w.length&&(e+='<div class="ability-upgrades">',w.forEach((h,L)=>{if(!h.property_upgrades||!h.property_upgrades.length)return;const P=L+1,K=h.property_upgrades.map(z=>{const $=S(z.name||""),B=z.bonus;return(typeof B=="number"&&B>0||typeof B=="string"&&!B.startsWith("-")&&!B.startsWith("+")?"+":"")+B+" "+$}).join(", ");e+='<div class="ability-tier"><span class="tier-badge">T'+P+'</span><span class="tier-text">'+y(K)+"</span></div>"}),e+="</div>"),e+="</div>"}),l.innerHTML=e;const d=s.items?.weapon_primary;if(d&&a[d]){const i=a[d].weapon_info;if(i){const c=(g,m)=>{const u=document.querySelector('[data-bs="'+g+'"]');u&&(u.innerHTML=m)},o=s.standard_level_up_upgrades||{},p=g=>g&&g!==0?'<span class="bs-per-level">+'+g+"</span>":"";i.damage_per_second!=null&&c("weapon-dps",i.damage_per_second.toFixed(1));const v=i.bullet_damage??i.damage_per_shot;v!=null&&c("weapon-bdmg",(+v).toFixed(1)+p(o.MODIFIER_VALUE_BASE_BULLET_DAMAGE_FROM_LEVEL)),i.clip_size!=null&&c("weapon-ammo",i.clip_size),i.bullets_per_second!=null&&c("weapon-bps",i.bullets_per_second.toFixed(2)),i.reload_duration!=null&&c("weapon-reload",i.reload_duration.toFixed(2)+"s")}}}catch(r){console.warn("Failed to fetch ability details:",r);let a="";t.forEach(e=>{const d=S(s.items[e]);a+='<div class="ability-box"><div class="ability-header"><span class="ability-name">'+y(d)+"</span></div></div>"}),l.innerHTML=a}}function S(s){return String(s||"").replace(/^(ability_|citadel_ability_)/i,"").replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}function A(){const s=document.getElementById("heroModal");s.classList.add("hidden"),s.setAttribute("aria-hidden","true")}function R(s){const t=document.getElementById("playerModal");if(!t)return;t.classList.remove("hidden");const l=document.getElementById("playerInput");l&&s?(l.value=s,T()):l&&!s&&l.focus()}function x(){const s=document.getElementById("playerModal");if(!s)return;s.classList.add("hidden");const t=document.getElementById("playerSearchResults"),l=document.getElementById("playerProfile");t&&(t.innerHTML=""),l&&(l.innerHTML="",l.classList.add("hidden"))}function U(){const s=document.getElementById("ovSearch");if(!s)return;const t=s.value.trim();t&&R(t)}async function T(){const s=document.getElementById("playerInput"),t=document.getElementById("playerSearchResults"),l=document.getElementById("playerProfile");if(!s||!t)return;const r=s.value.trim();if(!r){t.innerHTML='<div class="status">Enter a Steam username.</div>';return}t.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Searching...</div>',t.classList.remove("hidden"),l&&l.classList.add("hidden");try{const a=await fetch(I+"/v1/players/steam-search?username="+encodeURIComponent(r));if(!a.ok)throw new Error("HTTP "+a.status);const e=await a.json();if(!e||!e.length){t.innerHTML='<div class="status">No players found for "'+y(r)+'".</div>';return}t.innerHTML='<div class="search-results-header"><h3>'+e.length+" player"+(e.length!==1?"s":"")+' found</h3></div><div class="player-results-grid">'+e.slice(0,20).map(d=>'<div class="player-result-card" data-pid="'+y(d.account_id||d.steam_id)+'"><img class="player-result-avatar" src="'+(d.avatar_url||d.avatar||"")+`" alt="" loading="lazy" onerror="this.style.display='none'" /><div class="player-result-info"><h4>`+y(d.persona_name||d.name||"Unknown")+"</h4><p>"+y(d.account_id||d.steam_id||"")+"</p></div></div>").join("")+"</div>",t.querySelectorAll(".player-result-card").forEach(d=>d.addEventListener("click",()=>G(d.dataset.pid)))}catch{t.innerHTML='<div class="status">Search error. Please try again.</div>'}}async function G(s){const t=document.getElementById("playerSearchResults"),l=document.getElementById("playerProfile");if(l){l.classList.remove("hidden"),l.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Loading profile...</div>',t&&t.classList.add("hidden");try{const[r,a]=await Promise.allSettled([fetch(I+"/v1/players/"+encodeURIComponent(s)+"/match-history?limit=20"),fetch(I+"/v1/players/"+encodeURIComponent(s)+"/mmr-history")]),e=r.status==="fulfilled"&&r.value.ok?await r.value.json():null,d=a.status==="fulfilled"&&a.value.ok?await a.value.json():null;let i='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back to results</button>';if(i+='<div class="player-profile-header">',i+='<div class="player-profile-info"><h3>Player '+y(s)+"</h3>",d&&d.length){const c=d[d.length-1];c.badge_level!=null&&(i+="<p>Current Badge Level: <strong>"+c.badge_level+"</strong></p>")}if(i+="</div></div>",e&&e.length){let c=0,o=0;e.forEach(m=>{m.match_result==="Win"||m.player_team_won?c++:o++});const p=e.length>0?c/e.length*100:0;i+='<h4 class="sub-title">Recent Matches ('+e.length+")</h4>",i+='<div class="donut-container">'+se(p)+'<div class="donut-stats-side"><div class="ds-row"><span class="ds-label">Matches</span><span class="ds-value">'+e.length+'</span></div><div class="ds-row"><span class="ds-label">Wins</span><span class="ds-value" style="color:var(--accent)">'+c+'</span></div><div class="ds-row"><span class="ds-label">Losses</span><span class="ds-value" style="color:var(--brawler)">'+o+"</span></div></div></div>";const v={};e.forEach(m=>{const u=m.hero_id;u&&(v[u]||(v[u]={count:0,wins:0}),v[u].count++,(m.match_result==="Win"||m.player_team_won)&&v[u].wins++)});const g=Object.entries(v).sort((m,u)=>u[1].count-m[1].count).slice(0,8);if(g.length){const m=g[0][1].count;i+='<h4 class="sub-title">Most Played Heroes</h4><div class="hero-time-list">',g.forEach(([u,b])=>{const n=F(u),f=n?.images?.icon_image_small_webp||n?.images?.icon_image_small||"",E=n?.name||"Hero #"+u,w=m>0?b.count/m*100:0,h=b.count>0?b.wins/b.count*100:0,L=h>=50?"var(--accent)":"var(--brawler)";i+='<div class="hero-time-row">'+(f?'<img src="'+f+'" alt="" loading="lazy"/>':"<div></div>")+'<div><span class="htb-name">'+y(E)+'</span><div class="htb-bar"><div class="htb-bar-fill" style="width:'+w.toFixed(1)+'%"></div></div></div><span class="hero-time-stats"><span style="color:'+L+'">'+h.toFixed(0)+"%</span> · "+b.count+" games</span></div>"}),i+="</div>"}}else i+='<div class="status">No match history available or profile is private.</div>';l.innerHTML=i,document.getElementById("backBtn")?.addEventListener("click",N)}catch{l.innerHTML='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back</button><div class="status">Error loading profile.</div>',document.getElementById("backBtn")?.addEventListener("click",N)}}}function N(){const s=document.getElementById("playerSearchResults"),t=document.getElementById("playerProfile");s&&s.classList.remove("hidden"),t&&t.classList.add("hidden")}function se(s){const l=s/100*251.2,r=s>=50?"var(--accent)":"var(--brawler)";return'<div class="donut-chart"><svg viewBox="0 0 90 90"><circle class="donut-ring" cx="45" cy="45" r="40"/><circle class="donut-segment" cx="45" cy="45" r="40" stroke="'+r+'" stroke-dasharray="'+l.toFixed(1)+" "+251.2+'"/></svg><div class="donut-label"><span class="donut-value" style="color:'+r+'">'+s.toFixed(1)+'%</span><span class="donut-desc">Win Rate</span></div></div>'}let _="winrate",k="desc",C=null;async function H(){const s=document.getElementById("metaStatus"),t=document.getElementById("metaBody");if(!t)return;s&&(s.textContent="Loading hero stats..."),t.innerHTML='<tr><td colspan="8"><div class="meta-empty" style="animation:pulse 1.5s infinite"><p>Loading...</p></div></td></tr>';const l=document.getElementById("metaMinBadge")?.value||"0",r=document.getElementById("metaHeroType")?.value||"";let a=I+"/v1/analytics/hero-stats?min_badge_level="+l;try{const e=await fetch(a);if(!e.ok)throw new Error("HTTP "+e.status);const d=await e.json();if(!d||!d.length){t.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>No stats available.</p></div></td></tr>',s&&(s.textContent="No data found");return}const i=d.reduce((o,p)=>o+(p.matches||0),0);let c=d.map(o=>{const p=F(o.hero_id),v=o.matches||1;return{...o,hero:p,hero_type:p?.hero_type||"",win_rate:o.wins/v,pick_rate:i>0?v/i:0,avg_kills:(o.total_kills||0)/v,avg_deaths:(o.total_deaths||0)/v,avg_assists:(o.total_assists||0)/v}});r&&(c=c.filter(o=>o.hero_type===r)),C=c,_="winrate",k="desc",J(),s&&(s.textContent="Showing "+c.length+" heroes")}catch{t.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>Error loading stats. Try again.</p></div></td></tr>',s&&(s.textContent="Error loading stats")}}function J(){if(!C)return;const s=C.slice().sort((t,l)=>{let r,a;return _==="hero"?(r=(t.hero?.name||"").toLowerCase(),a=(l.hero?.name||"").toLowerCase(),k==="asc"?r.localeCompare(a):a.localeCompare(r)):_==="type"?(r=t.hero_type,a=l.hero_type,k==="asc"?r.localeCompare(a):a.localeCompare(r)):(_==="winrate"?(r=t.win_rate??t.winrate??0,a=l.win_rate??l.winrate??0):_==="pickrate"?(r=t.pick_rate??t.pickrate??0,a=l.pick_rate??l.pickrate??0):_==="matches"?(r=t.total_matches??t.matches??0,a=l.total_matches??l.matches??0):_==="kills"?(r=t.avg_kills??t.kills??0,a=l.avg_kills??l.kills??0):_==="deaths"?(r=t.avg_deaths??t.deaths??0,a=l.avg_deaths??l.deaths??0):_==="assists"?(r=t.avg_assists??t.assists??0,a=l.avg_assists??l.assists??0):(r=0,a=0),k==="asc"?r-a:a-r)});ae(s)}function ae(s){const t=document.getElementById("metaBody");if(!t)return;document.querySelectorAll("#metaTable thead th.sortable").forEach(a=>{const e=a.dataset.sort;a.classList.toggle("sort-active",e===_);const d=a.querySelector(".sort-arrow");if(d&&d.remove(),e===_){const i=document.createElement("span");i.className="sort-arrow",i.textContent=k==="asc"?" ▲":" ▼",a.appendChild(i)}});const l=Math.max(...s.map(a=>a.pick_rate??a.pickrate??0));let r="";s.forEach(a=>{const e=a.hero,d=e?.images?.icon_image_small_webp||e?.images?.icon_image_small||"",i=e?.name||"Hero #"+a.hero_id,c=a.hero_type||"unknown",o="var(--"+c+", var(--muted))",p=a.win_rate??a.winrate??0,v=a.pick_rate??a.pickrate??0,g=a.total_matches??a.matches??0,m=a.avg_kills??a.kills??0,u=a.avg_deaths??a.deaths??0,b=a.avg_assists??a.assists??0,n=(p*100).toFixed(1),f=(v*100).toFixed(2),E=l>0?v/l*100:0,w=p>=.5?"var(--accent)":"var(--brawler)";r+='<tr><td><div class="meta-hero-cell">'+(d?'<img class="meta-hero-portrait" src="'+d+'" alt="" loading="lazy"/>':"")+"<span>"+y(i)+'</span></div></td><td><span style="color:'+o+';font-weight:600;text-transform:capitalize;font-family:Chakra Petch,system-ui,sans-serif;font-size:.78rem">'+y(c)+'</span></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill winrate" style="width:'+n+"%;background:"+w+'"></div></div><span class="stat-value-label">'+n+'%</span></div></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill pickrate" style="width:'+E.toFixed(1)+'%"></div></div><span class="stat-value-label">'+f+"%</span></div></td><td>"+g.toLocaleString()+"</td><td>"+(typeof m=="number"?m.toFixed(1):m)+"</td><td>"+(typeof u=="number"?u.toFixed(1):u)+"</td><td>"+(typeof b=="number"?b.toFixed(1):b)+"</td></tr>"}),t.innerHTML=r||'<tr><td colspan="8"><div class="meta-empty"><p>No data.</p></div></td></tr>'}async function O(s){M.lbRegion=s;const t=document.getElementById("lbStatus"),l=document.getElementById("lbBody");if(l){t&&(t.textContent="Loading "+s+" leaderboard..."),l.innerHTML='<tr class="lb-placeholder"><td colspan="5"><div class="lb-empty"><div class="loading-dots"><span></span><span></span><span></span></div><p>Loading...</p></div></td></tr>',document.querySelectorAll(".region-btn").forEach(r=>r.classList.toggle("active",r.dataset.region===s));try{const r=await fetch(I+"/v1/leaderboard/"+encodeURIComponent(s));if(!r.ok)throw new Error("HTTP "+r.status);const a=await r.json(),e=Array.isArray(a)?a:a.entries||[];if(!e||!e.length){l.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>No leaderboard data available.</p></div></td></tr>',t&&(t.textContent="No data for "+s);return}let d="";e.slice(0,100).forEach(i=>{const c=i.rank??"-",o=typeof c=="number"?c:0,p=o===1?"top-1":o===2?"top-2":o===3?"top-3":"",v=i.account_name||"Unknown",g=i.badge_level??"-",m=i.ranked_rank!=null?i.ranked_rank:"-",u=i.ranked_subrank!=null?i.ranked_subrank:"",b=m!=="-"?m+(u?"."+u:""):"-";let n="-";i.top_hero_ids&&i.top_hero_ids.length&&(n=i.top_hero_ids.slice(0,3).map(f=>{const E=F(f);return E?y(E.name):"Hero #"+f}).join(", ")),d+='<tr><td class="lb-rank-cell '+p+'">'+c+'</td><td class="lb-player-cell"><span>'+y(v)+'</span></td><td class="lb-badge-cell">'+g+"</td><td>"+b+"</td><td>"+n+"</td></tr>"}),l.innerHTML=d,t&&(t.textContent="Showing top "+Math.min(e.length,100)+" players in "+s)}catch{l.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>Error loading leaderboard.</p></div></td></tr>',t&&(t.textContent="Error loading leaderboard")}}}function ne(){document.querySelectorAll(".nav-link").forEach(n=>n.addEventListener("click",()=>j(n.dataset.section)));const s=document.getElementById("heroSearch");s&&s.addEventListener("input",n=>ee(n.target.value)),document.querySelectorAll(".hero-card").forEach(n=>n.addEventListener("click",()=>{n.dataset.heroId&&q(n.dataset.heroId)})),document.querySelectorAll(".featured-hero").forEach(n=>n.addEventListener("click",()=>{n.dataset.heroId&&q(n.dataset.heroId)})),document.querySelectorAll(".ql-card, .ov-stat").forEach(n=>n.addEventListener("click",()=>{n.dataset.section&&j(n.dataset.section)}));const t=document.getElementById("ovSearch");t&&t.addEventListener("keydown",n=>{n.key==="Enter"&&U()});const l=document.getElementById("ovSearchBtn");l&&l.addEventListener("click",U);const r=document.getElementById("playerInput");r&&r.addEventListener("keydown",n=>{n.key==="Enter"&&T()});const a=document.getElementById("playerSearchBtn");a&&a.addEventListener("click",T);const e=document.getElementById("closeModalBtn");e&&e.addEventListener("click",A);const d=document.getElementById("heroModal");d&&d.addEventListener("click",n=>{n.target===d&&A()});const i=document.getElementById("playerModalClose");i&&i.addEventListener("click",x);const c=document.getElementById("playerModal");c&&c.addEventListener("click",n=>{n.target===c&&x()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&(A(),x())});const o=document.getElementById("themeToggle");o&&o.addEventListener("click",()=>W(document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark"));const p=document.getElementById("productSwitcherBtn"),v=document.getElementById("productSwitcherDropdown");p&&v&&(p.addEventListener("click",n=>{n.stopPropagation(),v.classList.toggle("hidden")}),document.addEventListener("click",n=>{!v.contains(n.target)&&n.target!==p&&v.classList.add("hidden")}));const g=document.getElementById("headerSearchBtn"),m=document.getElementById("headerSearchInput"),u=document.getElementById("headerSearch");g&&g.addEventListener("click",()=>{if(!u.classList.contains("open")){u.classList.add("open"),m.focus();return}const n=m?m.value.trim():"";n&&R(n)}),m&&m.addEventListener("keydown",n=>{if(n.key==="Enter"){const f=m.value.trim();f&&R(f)}n.key==="Escape"&&(u.classList.remove("open"),m.value="")});const b=document.getElementById("metaRefresh");b&&b.addEventListener("click",H),document.querySelectorAll("#metaTable thead th.sortable").forEach(n=>{n.addEventListener("click",()=>{const f=n.dataset.sort;_===f?k=k==="desc"?"asc":"desc":(_=f,k="desc"),J()})}),["metaRegion","metaMinBadge","metaHeroType"].forEach(n=>{const f=document.getElementById(n);f&&f.addEventListener("change",()=>{C&&H()})}),document.querySelectorAll(".region-btn").forEach(n=>n.addEventListener("click",()=>O(n.dataset.region)))}document.addEventListener("DOMContentLoaded",()=>{"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.scrollTo(0,0),Y(),ne(),j("overview")});window.LockedIn={showHeroDetails:q,closeModal:A,searchPlayer:T,loadProfile:G,backToSearch:N,fetchHeroStats:H,overviewSearch:U,openPlayerModal:R,closePlayerModal:x,fetchLeaderboard:O};
