const N=document.getElementById("app-data"),z=N?JSON.parse(N.dataset.payload||"{}"):{},w="https://api.deadlock-api.com",k={metaLoaded:!1,lbLoaded:!1,lbRegion:"Europe"},O=t=>(t||"").toString().toLowerCase().trim(),g=t=>String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");function H(t){document.documentElement.setAttribute("data-theme",t),localStorage.setItem("li-theme",t);const e=document.getElementById("themeToggle");e&&(e.textContent=t==="dark"?"Light Mode":"Dark Mode")}function J(){const t=localStorage.getItem("li-theme");if(t){H(t);return}H(window.matchMedia?.("(prefers-color-scheme:dark)").matches?"dark":"light")}function K(t){document.querySelectorAll(".nav-link").forEach(e=>e.classList.toggle("active",e.dataset.section===t))}function C(t){document.querySelectorAll("section.content").forEach(n=>{n.style.display="none"});const e=document.getElementById(t);e&&(e.style.display="",K(t),history.replaceState(null,"","#"+t)),t==="stats"&&!k.metaLoaded&&(k.metaLoaded=!0,x()),t==="leaderboard"&&!k.lbLoaded&&(k.lbLoaded=!0,q(k.lbRegion))}function G(t){const e=O(t);document.querySelectorAll(".hero-card").forEach(n=>{const i=n.dataset.heroName||"",s=n.dataset.heroType||"";n.style.display=!e||i.includes(e)||s.includes(e)?"":"none"})}function T(t){return z.heroes?.find(e=>String(e.id)===String(t))}function R(t){const e=T(t);if(!e)return;const n=document.getElementById("heroModal");document.getElementById("modalHeroName").textContent="";const i=document.getElementById("modalHeroDetails");i.innerHTML="",n.classList.remove("hidden"),n.setAttribute("aria-hidden","false");const s="var(--"+(e.hero_type||"brand")+")";let a="";const d=e.images?.icon_hero_card_webp||e.images?.icon_hero_card||"";a+='<div class="hd-header">',a+='<img class="hd-portrait" src="'+d+'" alt="'+g(e.name)+'" />',a+='<div class="hd-info">',a+='<h2 class="hd-name">'+g(e.name)+"</h2>",a+='<span class="hd-type-pill '+(e.hero_type||"")+'">'+g(e.hero_type||"Unknown")+"</span>";const l=e.description;if(l&&(typeof l=="object"?(l.role&&(a+='<p class="hd-desc"><strong>'+g(l.role)+"</strong></p>"),l.playstyle&&(a+='<p class="hd-desc">'+g(l.playstyle)+"</p>")):a+='<p class="hd-desc">'+g(l)+"</p>"),e.tags&&e.tags.length&&(a+='<div class="hd-tags">',e.tags.forEach(r=>{a+='<span class="hd-tag">'+g(r)+"</span>"}),a+="</div>"),a+="</div></div>",e.complexity){a+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Complexity</h4></div>',a+='<div style="display:flex;gap:4px;margin-bottom:1rem">';for(let r=1;r<=4;r++){const p=r<=e.complexity;a+='<span style="width:24px;height:8px;border-radius:4px;background:'+(p?s:"var(--surface-strong)")+'"></span>'}a+="</div></div>"}const c=r=>r!=null&&typeof r=="object"&&"value"in r?r.value:r;if(e.starting_stats){const r=e.starting_stats;a+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Starting Stats</h4></div>',a+='<div class="hd-stats-grid">',[["Max Health",c(r.max_health)],["Health Regen",c(r.base_health_regen??r.health_regen)],["Bullet Armor",(()=>{const h=c(r.bullet_armor_damage_reduction??r.bullet_armor);return h&&h!==0&&h!=="0"?h+"%":null})()],["Spirit Armor",(()=>{const h=c(r.tech_armor_damage_reduction??r.spirit_armor);return h&&h!==0&&h!=="0"?h+"%":null})()],["Move Speed",c(r.max_move_speed??r.move_speed)],["Sprint Speed",c(r.sprint_speed)],["Stamina",c(r.stamina)],["Light Melee",c(r.light_melee_damage)],["Heavy Melee",c(r.heavy_melee_damage)],["Crit Multiplier",c(r.crit_damage_received_scale)]].filter(([,h])=>h!=null&&h!==""&&h!==0&&h!=="0").forEach(([h,u])=>{a+='<div class="hd-stat-card"><div class="hd-stat-value" style="color:'+s+'">'+g(String(u))+"</div>",a+='<div class="hd-stat-label">'+g(h)+"</div></div>"}),a+="</div></div>"}const m=e.shop_stat_display?.weapon_stats_display;if(m){if(a+='<div class="hd-stats-section"><div class="hd-stats-bar"><h4>Weapon</h4></div>',a+='<div class="hd-stats-grid">',m.weapon_attributes&&m.weapon_attributes.length){const r={EWeaponAttribute_RapidFire:"Rapid Fire",EWeaponAttribute_MediumRange:"Medium Range",EWeaponAttribute_LongRange:"Long Range",EWeaponAttribute_ShortRange:"Short Range",EWeaponAttribute_SemiAutomatic:"Semi-Auto",EWeaponAttribute_FullAutomatic:"Full Auto",EWeaponAttribute_BurstFire:"Burst Fire"};m.weapon_attributes.forEach(p=>{a+='<div class="hd-stat-card"><div class="hd-stat-value" style="color:'+s+'">'+g(r[p]||p.replace(/EWeaponAttribute_/g,"").replace(/_/g," "))+"</div>",a+='<div class="hd-stat-label">Weapon Type</div></div>'})}(m.weapon_image_webp||m.weapon_image)&&(a+='<div style="grid-column:1/-1;text-align:center;padding:.5rem"><img src="'+(m.weapon_image_webp||m.weapon_image)+'" alt="Weapon" style="max-width:200px;height:auto;filter:drop-shadow(0 2px 8px rgba(0,0,0,.3))" loading="lazy"/></div>'),a+="</div></div>"}if(e.items&&typeof e.items=="object"){const r=Object.keys(e.items).filter(p=>p.startsWith("signature"));r.length&&(a+='<div class="hd-abilities-section"><h4>Abilities</h4>',r.sort().forEach(p=>{const h=e.items[p],u=String(h||"").replace(/^(ability_|citadel_ability_)/i,"").replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase());a+='<div class="ability-box"><div class="ability-header">'+g(u)+"</div></div>"}),a+="</div>")}i.innerHTML=a}function L(){const t=document.getElementById("heroModal");t.classList.add("hidden"),t.setAttribute("aria-hidden","true")}function S(t){const e=document.getElementById("playerModal");if(!e)return;e.classList.remove("hidden");const n=document.getElementById("playerInput");n&&t?(n.value=t,I()):n&&!t&&n.focus()}function B(){const t=document.getElementById("playerModal");if(!t)return;t.classList.add("hidden");const e=document.getElementById("playerSearchResults"),n=document.getElementById("playerProfile");e&&(e.innerHTML=""),n&&(n.innerHTML="",n.classList.add("hidden"))}function P(){const t=document.getElementById("ovSearch");if(!t)return;const e=t.value.trim();e&&S(e)}async function I(){const t=document.getElementById("playerInput"),e=document.getElementById("playerSearchResults"),n=document.getElementById("playerProfile");if(!t||!e)return;const i=t.value.trim();if(!i){e.innerHTML='<div class="status">Enter a Steam username.</div>';return}e.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Searching...</div>',e.classList.remove("hidden"),n&&n.classList.add("hidden");try{const s=await fetch(w+"/v1/players/steam-search?username="+encodeURIComponent(i));if(!s.ok)throw new Error("HTTP "+s.status);const a=await s.json();if(!a||!a.length){e.innerHTML='<div class="status">No players found for "'+g(i)+'".</div>';return}e.innerHTML='<div class="search-results-header"><h3>'+a.length+" player"+(a.length!==1?"s":"")+' found</h3></div><div class="player-results-grid">'+a.slice(0,20).map(d=>'<div class="player-result-card" data-pid="'+g(d.account_id||d.steam_id)+'"><img class="player-result-avatar" src="'+(d.avatar_url||d.avatar||"")+`" alt="" loading="lazy" onerror="this.style.display='none'" /><div class="player-result-info"><h4>`+g(d.persona_name||d.name||"Unknown")+"</h4><p>"+g(d.account_id||d.steam_id||"")+"</p></div></div>").join("")+"</div>",e.querySelectorAll(".player-result-card").forEach(d=>d.addEventListener("click",()=>j(d.dataset.pid)))}catch{e.innerHTML='<div class="status">Search error. Please try again.</div>'}}async function j(t){const e=document.getElementById("playerSearchResults"),n=document.getElementById("playerProfile");if(n){n.classList.remove("hidden"),n.innerHTML='<div class="status" style="animation:pulse 1.5s infinite">Loading profile...</div>',e&&e.classList.add("hidden");try{const[i,s]=await Promise.allSettled([fetch(w+"/v1/players/"+encodeURIComponent(t)+"/match-history?limit=20"),fetch(w+"/v1/players/"+encodeURIComponent(t)+"/mmr-history")]),a=i.status==="fulfilled"&&i.value.ok?await i.value.json():null,d=s.status==="fulfilled"&&s.value.ok?await s.value.json():null;let l='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back to results</button>';if(l+='<div class="player-profile-header">',l+='<div class="player-profile-info"><h3>Player '+g(t)+"</h3>",d&&d.length){const c=d[d.length-1];c.badge_level!=null&&(l+="<p>Current Badge Level: <strong>"+c.badge_level+"</strong></p>")}if(l+="</div></div>",a&&a.length){let c=0,m=0;a.forEach(u=>{u.match_result==="Win"||u.player_team_won?c++:m++});const r=a.length>0?c/a.length*100:0;l+='<h4 class="sub-title">Recent Matches ('+a.length+")</h4>",l+='<div class="donut-container">'+Q(r)+'<div class="donut-stats-side"><div class="ds-row"><span class="ds-label">Matches</span><span class="ds-value">'+a.length+'</span></div><div class="ds-row"><span class="ds-label">Wins</span><span class="ds-value" style="color:var(--accent)">'+c+'</span></div><div class="ds-row"><span class="ds-label">Losses</span><span class="ds-value" style="color:var(--brawler)">'+m+"</span></div></div></div>";const p={};a.forEach(u=>{const v=u.hero_id;v&&(p[v]||(p[v]={count:0,wins:0}),p[v].count++,(u.match_result==="Win"||u.player_team_won)&&p[v].wins++)});const h=Object.entries(p).sort((u,v)=>v[1].count-u[1].count).slice(0,8);if(h.length){const u=h[0][1].count;l+='<h4 class="sub-title">Most Played Heroes</h4><div class="hero-time-list">',h.forEach(([v,f])=>{const o=T(v),y=o?.images?.icon_image_small_webp||o?.images?.icon_image_small||"",E=o?.name||"Hero #"+v,A=u>0?f.count/u*100:0,F=f.count>0?f.wins/f.count*100:0,U=F>=50?"var(--accent)":"var(--brawler)";l+='<div class="hero-time-row">'+(y?'<img src="'+y+'" alt="" loading="lazy"/>':"<div></div>")+'<div><span class="htb-name">'+g(E)+'</span><div class="htb-bar"><div class="htb-bar-fill" style="width:'+A.toFixed(1)+'%"></div></div></div><span class="hero-time-stats"><span style="color:'+U+'">'+F.toFixed(0)+"%</span> · "+f.count+" games</span></div>"}),l+="</div>"}}else l+='<div class="status">No match history available or profile is private.</div>';n.innerHTML=l,document.getElementById("backBtn")?.addEventListener("click",W)}catch{n.innerHTML='<button type="button" class="btn btn-ghost btn-sm back-to-search" id="backBtn">← Back</button><div class="status">Error loading profile.</div>',document.getElementById("backBtn")?.addEventListener("click",W)}}}function W(){const t=document.getElementById("playerSearchResults"),e=document.getElementById("playerProfile");t&&t.classList.remove("hidden"),e&&e.classList.add("hidden")}function Q(t){const n=t/100*251.2,i=t>=50?"var(--accent)":"var(--brawler)";return'<div class="donut-chart"><svg viewBox="0 0 90 90"><circle class="donut-ring" cx="45" cy="45" r="40"/><circle class="donut-segment" cx="45" cy="45" r="40" stroke="'+i+'" stroke-dasharray="'+n.toFixed(1)+" "+251.2+'"/></svg><div class="donut-label"><span class="donut-value" style="color:'+i+'">'+t.toFixed(1)+'%</span><span class="donut-desc">Win Rate</span></div></div>'}let _="winrate",b="desc",M=null;async function x(){const t=document.getElementById("metaStatus"),e=document.getElementById("metaBody");if(!e)return;t&&(t.textContent="Loading hero stats..."),e.innerHTML='<tr><td colspan="8"><div class="meta-empty" style="animation:pulse 1.5s infinite"><p>Loading...</p></div></td></tr>';const n=document.getElementById("metaMinBadge")?.value||"0",i=document.getElementById("metaHeroType")?.value||"";let s=w+"/v1/analytics/hero-stats?min_badge_level="+n;try{const a=await fetch(s);if(!a.ok)throw new Error("HTTP "+a.status);const d=await a.json();if(!d||!d.length){e.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>No stats available.</p></div></td></tr>',t&&(t.textContent="No data found");return}const l=d.reduce((m,r)=>m+(r.matches||0),0);let c=d.map(m=>{const r=T(m.hero_id),p=m.matches||1;return{...m,hero:r,hero_type:r?.hero_type||"",win_rate:m.wins/p,pick_rate:l>0?p/l:0,avg_kills:(m.total_kills||0)/p,avg_deaths:(m.total_deaths||0)/p,avg_assists:(m.total_assists||0)/p}});i&&(c=c.filter(m=>m.hero_type===i)),M=c,_="winrate",b="desc",D(),t&&(t.textContent="Showing "+c.length+" heroes")}catch{e.innerHTML='<tr><td colspan="8"><div class="meta-empty"><p>Error loading stats. Try again.</p></div></td></tr>',t&&(t.textContent="Error loading stats")}}function D(){if(!M)return;const t=M.slice().sort((e,n)=>{let i,s;return _==="hero"?(i=(e.hero?.name||"").toLowerCase(),s=(n.hero?.name||"").toLowerCase(),b==="asc"?i.localeCompare(s):s.localeCompare(i)):_==="type"?(i=e.hero_type,s=n.hero_type,b==="asc"?i.localeCompare(s):s.localeCompare(i)):(_==="winrate"?(i=e.win_rate??e.winrate??0,s=n.win_rate??n.winrate??0):_==="pickrate"?(i=e.pick_rate??e.pickrate??0,s=n.pick_rate??n.pickrate??0):_==="matches"?(i=e.total_matches??e.matches??0,s=n.total_matches??n.matches??0):_==="kills"?(i=e.avg_kills??e.kills??0,s=n.avg_kills??n.kills??0):_==="deaths"?(i=e.avg_deaths??e.deaths??0,s=n.avg_deaths??n.deaths??0):_==="assists"?(i=e.avg_assists??e.assists??0,s=n.avg_assists??n.assists??0):(i=0,s=0),b==="asc"?i-s:s-i)});V(t)}function V(t){const e=document.getElementById("metaBody");if(!e)return;document.querySelectorAll("#metaTable thead th.sortable").forEach(s=>{const a=s.dataset.sort;s.classList.toggle("sort-active",a===_);const d=s.querySelector(".sort-arrow");if(d&&d.remove(),a===_){const l=document.createElement("span");l.className="sort-arrow",l.textContent=b==="asc"?" ▲":" ▼",s.appendChild(l)}});const n=Math.max(...t.map(s=>s.pick_rate??s.pickrate??0));let i="";t.forEach(s=>{const a=s.hero,d=a?.images?.icon_image_small_webp||a?.images?.icon_image_small||"",l=a?.name||"Hero #"+s.hero_id,c=s.hero_type||"unknown",m="var(--"+c+", var(--muted))",r=s.win_rate??s.winrate??0,p=s.pick_rate??s.pickrate??0,h=s.total_matches??s.matches??0,u=s.avg_kills??s.kills??0,v=s.avg_deaths??s.deaths??0,f=s.avg_assists??s.assists??0,o=(r*100).toFixed(1),y=(p*100).toFixed(2),E=n>0?p/n*100:0,A=r>=.5?"var(--accent)":"var(--brawler)";i+='<tr><td><div class="meta-hero-cell">'+(d?'<img class="meta-hero-portrait" src="'+d+'" alt="" loading="lazy"/>':"")+"<span>"+g(l)+'</span></div></td><td><span style="color:'+m+';font-weight:600;text-transform:capitalize;font-family:Chakra Petch,system-ui,sans-serif;font-size:.78rem">'+g(c)+'</span></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill winrate" style="width:'+o+"%;background:"+A+'"></div></div><span class="stat-value-label">'+o+'%</span></div></td><td><div class="stat-bar-wrapper"><div class="stat-bar"><div class="stat-bar-fill pickrate" style="width:'+E.toFixed(1)+'%"></div></div><span class="stat-value-label">'+y+"%</span></div></td><td>"+h.toLocaleString()+"</td><td>"+(typeof u=="number"?u.toFixed(1):u)+"</td><td>"+(typeof v=="number"?v.toFixed(1):v)+"</td><td>"+(typeof f=="number"?f.toFixed(1):f)+"</td></tr>"}),e.innerHTML=i||'<tr><td colspan="8"><div class="meta-empty"><p>No data.</p></div></td></tr>'}async function q(t){k.lbRegion=t;const e=document.getElementById("lbStatus"),n=document.getElementById("lbBody");if(n){e&&(e.textContent="Loading "+t+" leaderboard..."),n.innerHTML='<tr class="lb-placeholder"><td colspan="5"><div class="lb-empty"><div class="loading-dots"><span></span><span></span><span></span></div><p>Loading...</p></div></td></tr>',document.querySelectorAll(".region-btn").forEach(i=>i.classList.toggle("active",i.dataset.region===t));try{const i=await fetch(w+"/v1/leaderboard/"+encodeURIComponent(t));if(!i.ok)throw new Error("HTTP "+i.status);const s=await i.json(),a=Array.isArray(s)?s:s.entries||[];if(!a||!a.length){n.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>No leaderboard data available.</p></div></td></tr>',e&&(e.textContent="No data for "+t);return}let d="";a.slice(0,100).forEach(l=>{const c=l.rank??"-",m=typeof c=="number"?c:0,r=m===1?"top-1":m===2?"top-2":m===3?"top-3":"",p=l.account_name||"Unknown",h=l.badge_level??"-",u=l.ranked_rank!=null?l.ranked_rank:"-",v=l.ranked_subrank!=null?l.ranked_subrank:"",f=u!=="-"?u+(v?"."+v:""):"-";let o="-";l.top_hero_ids&&l.top_hero_ids.length&&(o=l.top_hero_ids.slice(0,3).map(y=>{const E=T(y);return E?g(E.name):"Hero #"+y}).join(", ")),d+='<tr><td class="lb-rank-cell '+r+'">'+c+'</td><td class="lb-player-cell"><span>'+g(p)+'</span></td><td class="lb-badge-cell">'+h+"</td><td>"+f+"</td><td>"+o+"</td></tr>"}),n.innerHTML=d,e&&(e.textContent="Showing top "+Math.min(a.length,100)+" players in "+t)}catch{n.innerHTML='<tr><td colspan="5"><div class="lb-empty"><p>Error loading leaderboard.</p></div></td></tr>',e&&(e.textContent="Error loading leaderboard")}}}function X(){document.querySelectorAll(".nav-link").forEach(o=>o.addEventListener("click",()=>C(o.dataset.section)));const t=document.getElementById("heroSearch");t&&t.addEventListener("input",o=>G(o.target.value)),document.querySelectorAll(".hero-card").forEach(o=>o.addEventListener("click",()=>{o.dataset.heroId&&R(o.dataset.heroId)})),document.querySelectorAll(".featured-hero").forEach(o=>o.addEventListener("click",()=>{o.dataset.heroId&&R(o.dataset.heroId)})),document.querySelectorAll(".ql-card, .ov-stat").forEach(o=>o.addEventListener("click",()=>{o.dataset.section&&C(o.dataset.section)}));const e=document.getElementById("ovSearch");e&&e.addEventListener("keydown",o=>{o.key==="Enter"&&P()});const n=document.getElementById("ovSearchBtn");n&&n.addEventListener("click",P);const i=document.getElementById("playerInput");i&&i.addEventListener("keydown",o=>{o.key==="Enter"&&I()});const s=document.getElementById("playerSearchBtn");s&&s.addEventListener("click",I);const a=document.getElementById("closeModalBtn");a&&a.addEventListener("click",L);const d=document.getElementById("heroModal");d&&d.addEventListener("click",o=>{o.target===d&&L()});const l=document.getElementById("playerModalClose");l&&l.addEventListener("click",B);const c=document.getElementById("playerModal");c&&c.addEventListener("click",o=>{o.target===c&&B()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&(L(),B())});const m=document.getElementById("themeToggle");m&&m.addEventListener("click",()=>H(document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark"));const r=document.getElementById("productSwitcherBtn"),p=document.getElementById("productSwitcherDropdown");r&&p&&(r.addEventListener("click",o=>{o.stopPropagation(),p.classList.toggle("hidden")}),document.addEventListener("click",o=>{!p.contains(o.target)&&o.target!==r&&p.classList.add("hidden")}));const h=document.getElementById("headerSearchBtn"),u=document.getElementById("headerSearchInput"),v=document.getElementById("headerSearch");h&&h.addEventListener("click",()=>{if(!v.classList.contains("open")){v.classList.add("open"),u.focus();return}const o=u?u.value.trim():"";o&&S(o)}),u&&u.addEventListener("keydown",o=>{if(o.key==="Enter"){const y=u.value.trim();y&&S(y)}o.key==="Escape"&&(v.classList.remove("open"),u.value="")});const f=document.getElementById("metaRefresh");f&&f.addEventListener("click",x),document.querySelectorAll("#metaTable thead th.sortable").forEach(o=>{o.addEventListener("click",()=>{const y=o.dataset.sort;_===y?b=b==="desc"?"asc":"desc":(_=y,b="desc"),D()})}),["metaRegion","metaMinBadge","metaHeroType"].forEach(o=>{const y=document.getElementById(o);y&&y.addEventListener("change",()=>{M&&x()})}),document.querySelectorAll(".region-btn").forEach(o=>o.addEventListener("click",()=>q(o.dataset.region)))}document.addEventListener("DOMContentLoaded",()=>{J(),X(),C(location.hash?location.hash.slice(1):"overview")});window.LockedIn={showHeroDetails:R,closeModal:L,searchPlayer:I,loadProfile:j,backToSearch:W,fetchHeroStats:x,overviewSearch:P,openPlayerModal:S,closePlayerModal:B,fetchLeaderboard:q};
